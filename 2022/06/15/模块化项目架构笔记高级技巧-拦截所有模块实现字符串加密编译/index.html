<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content=""><meta name="google-site-verification" content="UKlpQSB6IlVlxjxgprQbTNRUiLE1BnpIV5zeQ_MYkks"><title> 模块化项目架构笔记高级技巧拦截所有模块实现字符串加密编译 · 情迁博客</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="模块化项目架构笔记高级技巧拦截所有模块实现字符串加密编译 - 情随事迁"><meta name="keywords"><meta name="author" content="情随事迁"><meta name="referrer" content="no-referrer"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="https://lozn.top/atom.xml" title="情迁博客"><meta name="generator" content="Hexo 5.4.1"></head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="/images/logo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="https://godhand.lozn.top" target="_blank" data-hover="神之手" class="nav-list-link">神之手</a></li><li class="nav-list-item"><a href="https://robot.lozn.top" target="_blank" data-hover="机器人" class="nav-list-link">机器人</a></li><li class="nav-list-item"><a href="/categories/情迁软件/" target="_self" data-hover="情迁" class="nav-list-link">情迁</a></li><li class="nav-list-item"><a href="https://www.jianshu.com/u/9b0768e66d01" target="_blank" data-hover="简书" class="nav-list-link">简书</a></li><li class="nav-list-item"><a href="/update/" target="_self" data-hover="下载" class="nav-list-link">下载</a></li><li class="nav-list-item"><a href="/about/" target="_self" data-hover="关于" class="nav-list-link">关于</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page --><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">模块化项目架构笔记高级技巧拦截所有模块实现字符串加密编译</h1><div class="post-info">2022-06-15<p class="visit"><i data-hk-page="current">Loading</i><span>次访问</span></p></div><div class="post-content"><p>简书链接:<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/e4703eeff0db">模块化项目架构笔记高级技巧拦截所有模块实现字符串加密编译</a><br>文章字数：3787,阅读全文大约需要15分钟</p>
<h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>非模块划分有一种方法，<br>模块划分则2种方法 ，非模块划分是指一个项目，编译时条件删除对应的代码，资源， 在前期需要快速交付时可以使用，即不同模块先划分包名文件夹，然后拦截编译过程删除指定代码从而实现不打包具体代码 ，但是后期优化则应该转换 抽取为具体模块。</p>
<h1 id="具体描述"><a href="#具体描述" class="headerlink" title="具体描述"></a>具体描述</h1><p>a b c 公司都有 登录 ，首页 ，应用模块，<br>其区别在于首页的tab不一样，功能展示不一样，<br>但是a公司 首页tab没有消息，推送， b公司则有推送，但是没有对应的业务模块如 分箱之类的</p>
<p>但是 c公司 要推送，要 分箱，都要 </p>
<p>tab中的应用tab,对应了所有的模块，这些模块的读取 图标，文字都是本地的，而不是通过接口获取的，<br>假设 tab中的应用中包含了   a公司需要考勤模块 b公司需要打卡模块  ，d公司 分别都需要，<br>这tab中的ApplistFragment应该放哪里呢？ 是各自实现还是根据channel判断？如果 是a ,b,c公司都使用application不用分渠道法，则需要通过实现接口法来做。</p>
<h1 id="第一种模块划分法"><a href="#第一种模块划分法" class="headerlink" title="第一种模块划分法"></a>第一种模块划分法</h1><p>base 模块 ： util,http, 基础ui 颜色，主题 (library)<br>ui模块：登录 闪屏  ui模块引入base模块 (library)</p>
<p>a公司  创建application类型，然后 引入 ui模块 ， 打包成apk</p>
<p>b公司  创建application类型，然后 引入 ui模块 ，打包成apk<br>拦截一些tab之类的 实现<br>但是假设 a 公司需要  分箱 b公司也需要分箱，则需要把分箱再创建出一个模块 ，然后其应用类型分别需要引入这个分箱模块（分箱包括了界面,act,颜色，逻辑自然也引入了ui,base模块)</p>
<p>对于a,b 公司都用到了考勤， 但是a公司需要打卡 b公司不需要，而且有一个界面就是展示了所有入口，则需要再这个界面</p>
<p>写不同的代码实现 ，</p>
<p>在mainactivity .new AppListtab()的时候 拦截new AppListtab  返回一个自己公司对应的tab实现，<br>这种方法感觉坑少一些，channel大法，其实并不香，对于交叉引用的逻辑难以处理。<br>需要每一个公司在每一个公司对应的application的gradle中需要引入一个或者多个 模块 ，然后代码写这些展示代码</p>
<h1 id="第二种模块划分法"><a href="#第二种模块划分法" class="headerlink" title="第二种模块划分法"></a>第二种模块划分法</h1><p>base 模块  util,http, 基础ui 颜色，主题 (library)<br>app : 登录 闪屏  ui模块引入base模块  (application)<br>根据 channel判断不同的类型引入不同的实现<br>拦截一些tab之类的根据channel判断</p>
<p>假设使用的是channel 法类似于c语言的条件编译，java没有条件编译，某一些引入了 不需要的模块，只是通过判断 不展示是不行的，而是彻底的不导入，则需要用compileOnly法实现<br>这样打包后 对应的模块并没打包进去，但是这个逻辑代码是一直存在的，通过判断channel不执行这句话也不会报错。<br>但是对于不同模块的drawable资源，分离不进行打包就太难了，需要伪造一个R 类 然后 compileOnly实现，<br>databind则坑更多，compileOnly 引入的databind模块，也会添加进去，这导致了classdefined,所以compileOnly是不能直接引入databind模块，<br>只能把application中用到的，自己定义一个模块然后创建一个假的 类，然后使用compileOnly实现。<br>或者是用多channel ,指定同一个包名，切换任意buildVariant都能识别到<br>总结：第二种方法<br>compileOnly法坑太多了，假设 打卡和 考勤都引入了 base（util,http,theme）但是使用了databind,就会导致会直接合并，这是databind的bug.</p>
<h2 id="第三种"><a href="#第三种" class="headerlink" title="第三种"></a>第三种</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">  def moduleSrcDirs = [</span><br><span class="line">            &quot;accept&quot;, &quot;demo&quot;, &quot;manager&quot;, &quot;webview&quot;, &quot;misc&quot;,  &quot;product&quot;, &#x27;quality&#x27;</span><br><span class="line">    ]</span><br><span class="line">   sourceSets &#123;</span><br><span class="line">        main &#123;</span><br><span class="line">            jniLibs.srcDirs = [&#x27;libs&#x27;]</span><br><span class="line">//            exclude &#x27;schemaorg_apache_xmlbeans/**&#x27;</span><br><span class="line">            res.srcDirs = [&#x27;src/main/res&#x27;, &quot;src/vip/res&quot;]</span><br><span class="line">            moduleSrcDirs.forEach &#123;//下面这些是等待重构的代码</span><br><span class="line">                res.srcDirs += &#x27;src/main/mymodule/&#x27; + it + &#x27;/res&#x27;</span><br><span class="line">                java.srcDirs += &#x27;src/main/mymodule/&#x27; + it + &#x27;/java&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        test2 &#123;</span><br><span class="line">            manifest.srcFile &#x27;src/main/java/AndroidManifest.xml&#x27;</span><br><span class="line">            jniLibs.srcDirs = [&#x27;libs&#x27;]</span><br><span class="line">            res.srcDirs = [&#x27;src/main/res&#x27;, &quot;src/rlkm/res&quot;]</span><br><span class="line">            moduleSrcDirs.forEach &#123;</span><br><span class="line">                res.srcDirs += &#x27;src/main/mymodule/&#x27; + it + &#x27;/res&#x27;</span><br><span class="line">                java.srcDirs += &#x27;src/main/mymodule/&#x27; + it + &#x27;/java&#x27;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>如果是已经写好的很庞大的app,<br>不区分模块，全部在application节点，但是如果要重构模块，为了降低成本和可立即交付建议先给不同模块划分到不同的包名，<br>使用gradle配置指定多个java 路径 多个res路径，<br>不同的模块功能类逻辑分不同的包名路径，比如 a模块放到com.example.module.a下 b则放到com.example.module.b下。<br>基于channel 拦截编译过程 根据channel删掉文件夹编译出来的class,有点类似第二种，但是这只能干掉java代码，布局资源是很难区分干掉了，除非定义一种命名再拦截，但是颜色，文字呢？<br>这种方法需要每次强制关闭 UP-TO-DATE 也就不能用快速缓存编译 ，坑也很多。<br>不过这种改造成本最低的，对于前期并没有划分模块的人来说偷懒是很实用的，虽然图片，资源打包进去了，至少 代码模块没有打包进去，<br>这样强制干掉class的效果也类似于compileOnly,结合了channel逻辑判断，实现不执行那句被干掉的代码运行的时候就不会报错。<br>另外我只研究出来了 拦截java代码删除的逻辑，但是并没有找到res 布局 文件删除的逻辑，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> variant.javaCompileProvider.configure &#123;</span><br><span class="line">            it.doLast &#123;</span><br><span class="line">                var myprovider = variant.javaCompileProvider.get()</span><br><span class="line">                print(&quot;build dir $&#123;myprovider.destinationDir&#125;\n&quot;);</span><br><span class="line">                if (CHANNEL.XX == DEPEND_CHANNEL &amp;&amp; isRelease) &#123;</span><br><span class="line">                    moduleSrcDirs.forEach &#123;</span><br><span class="line">                        if (it.toString() == &quot;splitmerge&quot;</span><br><span class="line">                                || it.toString() == &quot;print&quot;</span><br><span class="line">                                || it.toString() == &quot;product&quot;</span><br><span class="line">                                || it.toString() == &quot;zxing&quot;</span><br><span class="line">                        ) &#123;</span><br><span class="line">                            print(&quot;keep module &quot; + it.toString() + &quot;\n&quot;);</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            String currentDeleteDir = new File(myprovider.destinationDir, &#x27;/module/&#x27; + it + &#x27;&#x27;)</span><br><span class="line">//                            String currentDeleteDir = new File(variant.javaCompile.destinationDir, &#x27;/module/&#x27; + it + &#x27;&#x27;)</span><br><span class="line">                            File file1 = new File(currentDeleteDir)</span><br><span class="line">                            if (file1.exists()) &#123;</span><br><span class="line"></span><br><span class="line">                                file1.deleteDir();</span><br><span class="line">                                print(&quot;delete dir $currentDeleteDir succ!\n&quot;)</span><br><span class="line">                            &#125; else &#123;</span><br><span class="line">                                print(&quot;delete dir $currentDeleteDir fail no exist\n&quot;)</span><br><span class="line"></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure>
<p>由于删 除了文件夹，导致再次编译会出现错误为了忽略todo 需要强制刷新</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> //忽略变体渠道</span><br><span class="line">    variantFilter &#123; variant -&gt;</span><br><span class="line">        def names = variant.flavors*.name</span><br><span class="line">        // To check for a certain build type, use variant.buildType.name == &quot;&lt;buildType&gt;&quot;</span><br><span class="line">        if (names.contains(&quot;XX&quot;) &amp;&amp; names.contains(&quot;debug&quot;)) &#123;</span><br><span class="line">            // Gradle ignores any variants that satisfy the conditions above.</span><br><span class="line">            setIgnore(true)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">//强制更新的逻辑</span><br><span class="line">//设置强制 更新</span><br><span class="line">    gradle.taskGraph.whenReady &#123; taskGraph -&gt;</span><br><span class="line">        def tasks = taskGraph.getAllTasks()</span><br><span class="line">        tasks.each &#123;</span><br><span class="line">            def taskName = it.getName()</span><br><span class="line">            if (isRelease &amp;&amp; DEPEND_CHANNEL != CHANNEL.DEFAULT) &#123;</span><br><span class="line">                if (taskName == &#x27;compileScReleaseJavaWithJavac&#x27; || taskName == &#x27;processScReleaseMainManifest&#x27;) &#123;</span><br><span class="line">                    print(&quot;found task $taskName\n&quot;)</span><br><span class="line">                    System.err.println(&quot;$&#123;DEPEND_CHANNEL&#125; Found release  $taskName needReleaseBuld&quot;)</span><br><span class="line">                    it.setOnlyIf &#123; true &#125;</span><br><span class="line">                    it.outputs.upToDateWhen &#123; false &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>删除资源</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">applicationVariants.all &#123; variant -&gt;</span><br><span class="line">    variant.getMergeAssetsProvider().configure &#123;</span><br><span class="line">        it.doLast &#123;</span><br><span class="line">            var getMergeAssetsProvider = variant.getMergeAssetsProvider().get()</span><br><span class="line">            System.err.println(&quot;getMergeAssetsProvider  xsb :$&#123;getMergeAssetsProvider.variantName&#125;&quot;);</span><br><span class="line">            //incrementalFolder</span><br><span class="line">            System.err.println(&quot;delete dir   xsb :$&#123;getMergeAssetsProvider.incrementalFolder&#125;&quot;);</span><br><span class="line">            delete(fileTree(dir: getMergeAssetsProvider.incrementalFolder, includes: [&#x27;*.zip&#x27;, &quot;&#x27;*.xsb&#x27;&quot;]))</span><br><span class="line"></span><br><span class="line">            System.err.println(&quot;getMergeAssetsProvider  xsb :$&#123;getMergeAssetsProvider.incrementalFolder&#125;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>build.gradle中根据channel生成变量</p>
<p>···<br>enum CHANNEL {<br>XX1, DEFAULT, XX2<br>}<br>···</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">def isRelease = false;</span><br><span class="line">//android.buildTypes.release.ndk.debugSymbolLevel = &#123;SYMBOL_TABLE |FULL &#125;</span><br><span class="line">def DEPEND_CHANNEL = CHANNEL.XX2// CHANNEL.DEFAULT</span><br><span class="line">gradle.startParameter.getTaskNames().each &#123; task -&gt;</span><br><span class="line">if (task.toLowerCase().contains(&quot;test1&quot;)) &#123;</span><br><span class="line">DEPEND_CHANNEL = CHANNEL.XX1</span><br><span class="line">System.err.println(&quot; current :XX1 kemi channel $&#123;task&#125;&quot;)</span><br><span class="line">&#125; else if (task.toLowerCase().contains(&quot;test2&quot;)) &#123;</span><br><span class="line">DEPEND_CHANNEL = CHANNEL.XX2</span><br><span class="line">System.err.println(&quot;  current :XX2 channel $&#123;task&#125;&quot;)</span><br><span class="line">&#125; else &#123;</span><br><span class="line">DEPEND_CHANNEL = CHANNEL.DEFAULT</span><br><span class="line">System.err.println(&quot; current :default channel $&#123;task&#125;&quot;)</span><br><span class="line">&#125;</span><br><span class="line">if (task.toLowerCase().contains(&quot;release&quot;)) &#123;</span><br><span class="line">isRelease = true;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>定义channel</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> flavorDimensions &#x27;myflavor&#x27;</span><br><span class="line">    productFlavors &#123;</span><br><span class="line">    test1 &#123;</span><br><span class="line">            manifestPlaceholders = [</span><br><span class="line">                    JPUSH_PKGNAME: &quot;com.example.xxx&quot;,</span><br><span class="line">                    JPUSH_APPKEY : &quot;xxx&quot;,</span><br><span class="line">                    JPUSH_CHANNEL: &quot;test&quot;,</span><br><span class="line">                    //JPush 上注册的包名对应的 Appkey.</span><br><span class="line">                    GETUI_APPID  : xx.ext.GETUI_APPID,</span><br><span class="line">                    test_CHANNEL   : &quot;test123&quot;]</span><br><span class="line"></span><br><span class="line">//            manifestPlaceholders = [GETUI_APPID: rootProject.ext.GETUI_APPID, test_CHANNEL: &quot;test&quot;]</span><br><span class="line">            buildConfigField(&quot;String&quot;, &quot;CHANNEL&quot;, &quot;\&quot;test\&quot;&quot;)</span><br><span class="line">            buildConfigField(&quot;int[]&quot;, &quot;MODULES&quot;, &quot;new int[]&#123;0,1,2,3,4,5,6,7,8,9,10,11,12,13&#125;&quot;)</span><br><span class="line">            buildConfigField(&quot;String[]&quot;, &quot;MODULES_NAME&quot;, &quot;&quot;&quot;new String[]&#123;&quot;all&quot;&#125;&quot;&quot;&quot;)</span><br><span class="line">            resValue &quot;string&quot;, &quot;test_channel&quot;, &quot;teststr&quot;</span><br><span class="line">            buildConfigField(&quot;String&quot;, &quot;REGCODE&quot;, &quot;\&quot;aaa\&quot;&quot;)</span><br><span class="line"></span><br><span class="line">            dimension &#x27;example&#x27;</span><br><span class="line">            applicationId &quot;com.example.testmes&quot;</span><br><span class="line">//            applicationIdSuffix &#x27;.ui&#x27;</span><br><span class="line">            versionNameSuffix &quot;-iview&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        test2&#123;</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>总结： </p>
<p>第二种 第一种重构的成本太大，不过第一种和第二种都是可以切换的，前提都是需要把模块功能再次细分抽离出模块，到时候从第二种变更第一种问题应该也不是很大。</p>
<p>但是第二种真的坑太多了，主要的坑是主应用 是ab公司一个代码，大师a引用了 a模块 b公司引用了b模块的代码 ，假设 a公司不需要b模块，通过impl控制大法会导致识别不到类编译过不了，<br>compileOnly大法则不能有databind存在的情况，改正compileOnly则导致databind bug, 把代码引入进去了， 所以我另外创建一个模块作为接口类，但是这个需要每一个方法都定义依然有很多bug,所以我现在是尽量避免使用这种方法，而是使用每一个channel定义一个实现类方法</p>
<p>，直接定义一个base_interface接口模块，专门解决找不到的类的情况，然后伪造 一些找不到的类，但是 对于如R,BR类，但是如果方法太多的话很容易反复反复编译出错警告，所以工作量大就难搞了。</p>
<p>图标，文字无法分离，如果要分离也需要自己定义一个，  所以这里的工作量是最大的，后面偷懒就只能让图标文字也打包进去，否则需要伪造图标id类 到base_interface接口模块来解决编译找不到类的情况。</p>
<p>结果发现还是有很多问题，最后我不得已，给每一个channel创造一个模块impl, 而 ModuleManager 类只是一个抽象类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> public static ModuleManager getInstance() &#123;</span><br><span class="line">        if (moduleManager == null) &#123;</span><br><span class="line">            synchronized (ModuleManager.class) &#123;</span><br><span class="line">                if (moduleManager == null) &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        Class&lt;?&gt; aClass = Class.forName(&quot;channel.ModuleManagerImpl&quot;);</span><br><span class="line">                        moduleManager= (ModuleManager) aClass.newInstance();</span><br><span class="line">                    &#125; catch (Throwable e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                        throw new RuntimeException(&quot;not found moduleManager impl!&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">//                    moduleManager = new ModuleManagerImpl();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return moduleManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public abstract boolean createModuleMenu(ArrayList&lt;SubMenuItemI&gt; data, int classid, boolean match, boolean addTitle) ;</span><br></pre></td></tr></table></figure>
<p>这样我的图标在不同的模块下也不影响，因为基于某个channel的引用肯定是能找到对应图标引用的。</p>
<p>另外如果模块太多太细，第一种还是第二种都很累，需要反复定义过多的模块，图标，文字， 判断 引用</p>
<p>而且还要交叉的情况出现，如二维码模块和打印模块，某些模块不需要某些需要，交叉很难搞的，这时候用第三种方法或许不错，在编译过程中一刀切直接干掉某个目录，但是第三种方法 </p>
<p>只适合代码全部在一个模块的，不然每一个模块的拦截似乎需要再每一个模块写代码实现</p>
<p>除了代码的坑还有资源Id的坑，假设 资源R.string.app_name要让3个都能访问到，在3个里面定义，如果安装官方的优化就会掉坑里，<br>因为每一个都是隔离不共享同一个名称。</p>
<p>另外对于交叉代码逻辑 channel</p>
<p>下面是使用多个类实现不同的appmodulelist完整代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public  abstract class ModuleManager &#123;</span><br><span class="line">    public static ModuleManager getInstance() &#123;</span><br><span class="line">        if (moduleManager == null) &#123;</span><br><span class="line">            synchronized (ModuleManager.class) &#123;</span><br><span class="line">                if (moduleManager == null) &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        Class&lt;?&gt; aClass = Class.forName(&quot;channel.ModuleManagerImpl&quot;);</span><br><span class="line">                        moduleManager= (ModuleManager) aClass.newInstance();</span><br><span class="line">                    &#125; catch (Throwable e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                        throw new RuntimeException(&quot;not found moduleManager impl!&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">//                    moduleManager = new ModuleManagerImpl();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return moduleManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static ModuleManager moduleManager;</span><br><span class="line"></span><br><span class="line">    @NotNull</span><br><span class="line">    public abstract  String getClientID();</span><br><span class="line"></span><br><span class="line">    public abstract  void onAgreeAgreement(Context context);</span><br><span class="line">//        JCollectionAuth.setAuth(context,true);</span><br><span class="line"></span><br><span class="line">    public abstract void initPush(Context context) ;</span><br><span class="line"></span><br><span class="line">    public abstract boolean createModuleMenu(ArrayList&lt;SubMenuItemI&gt; data, int classid, boolean match) ;</span><br><span class="line"></span><br><span class="line">    public void writeExcelFromModel(ArrayList&lt;TableModel&gt; tableModels, String absolutePath) &#123;</span><br><span class="line">        WriteExcelUtils.writeExcelFromModel(tableModels,absolutePath);;//sc的报表也有写xls,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public abstract  boolean isRuiliChannel();</span><br><span class="line"></span><br><span class="line">    public abstract  boolean isVipChannel();</span><br><span class="line"></span><br><span class="line">    public abstract int[] getModules();</span><br><span class="line"></span><br><span class="line">    public abstract ArrayList&lt;ModuleMenu&gt;  getModulesGroup();</span><br><span class="line"></span><br><span class="line">    public abstract void jumpModulePage(FragmentActivity activity, SubIconMenuBean menuBean);</span><br><span class="line"></span><br><span class="line">    public List&lt;? extends SubMenuItemI&gt; getCommonlyUseModuleFromDb() &#123;</span><br><span class="line">        return SCUtil.getCommonlyUseModuleFromDb();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public abstract List getAllReportItem();</span><br><span class="line"></span><br><span class="line">    public  abstract void onLogin(JSONObject jsonObject);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 首页tab 不同渠道不同的tab, 有的channel没有消息列表，没有首页，根据id查找返回fragment </span><br><span class="line">     * @param navigation_app</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public abstract FragmentUtil.PairX&lt;String, SoftReference&lt;Fragment&gt;&gt; createTabById(int navigation_app);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>而ModuleManagerImpl 在每一个渠道是每一个Application模块定义 不同的java&#x2F;channel的实现即可。</p>
<p>依赖判断的2种方法<br>根据if 或者 直接渠道名Api 也可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">testApi project(path: &#x27;:print&#x27;)</span><br><span class="line">test2Api(project(path: &#x27;:upmaterial&#x27;))</span><br><span class="line">    if (DEPEND_CHANNEL == CHANNEL.TEST1) &#123;</span><br><span class="line">compileOnly project(path: &#x27;:third_xc_chartlib&#x27;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是 是有区别的，使用if 条件 implement和  渠道名implement的区别是 前者的情况假设A.class被另外一个if条件引用了，但是没走那个逻辑，调用那个类却没提示红色错误，只有编译运行才报错，这不符合美观，而使用后者则很明显的看出来它找不到改类。<br>布局不生效，有可能是多channel,的问题，想要生效就把这个channel顺序调整为第一个，</p>
<p>重构分模块呢，第三步必须有，<br>也就是子同一个项目 先把模块放到不同的包，利用开发工具的重构 方法重构，把交叉的公共代码分离出来，<br>这样建立模块的时候保持路径不变，这样合并起来也不会乱。，比如 消息列表的模块我弄到一个文件夹了，然后我新建一个模块，按文件夹路径 直接移动过去，直接运行会报错的，利用报错提示一步一步处理就ok了。</p>
<p>关于主题部分，抽取到base,关于appcontext可以 在base里面 定义一个，然后 应用 里面继承它就行了。<br>getInstance()的套路代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">public class SuperContext  extends Application &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    protected static SuperContext SuperContext;</span><br><span class="line">    protected Handler handler;</span><br><span class="line">    public android.os.Handler getHandler() &#123;</span><br><span class="line">        return handler;</span><br><span class="line">    &#125;</span><br><span class="line">    public static SuperContext getInstance() &#123;</span><br><span class="line">        return SuperContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate() &#123;</span><br><span class="line">        super.onCreate();</span><br><span class="line"></span><br><span class="line">        SuperContext = this;</span><br><span class="line">        handler = new Handler();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>可以慢慢的把东西弄到第二层，但是又可以随时交付不包含代码的app，<br>分模块有分模块的弊端，分模块后，混淆配置可能需要每一个模块都引用这个混淆配置了z<br>指定目录的写法,把它复制到每一个模块即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proguardFiles getDefaultProguardFile(&#x27;proguard-android-optimize.txt&#x27;), new File(getRootDir().absolutePath+&quot;/app&quot;,&#x27;proguard-rules.pro&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>下面是完整build.gradle</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import java.text.SimpleDateFormat</span><br><span class="line"></span><br><span class="line">plugins &#123;</span><br><span class="line">    //noinspection DuplicatePlatformClasses</span><br><span class="line">    id &#x27;com.android.application&#x27;</span><br><span class="line">    id &#x27;kotlin-android&#x27;</span><br><span class="line">    id &#x27;kotlin-kapt&#x27;</span><br><span class="line">    id &#x27;com.huawei.agconnect&#x27;</span><br><span class="line">//    id &#x27;kotlin-android-extensions&#x27;</span><br><span class="line">//    id &#x27;kotlin-parcelize&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">enum CHANNEL &#123;</span><br><span class="line">    RUILI, DEFAULT, LZ</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def isRelease = false;</span><br><span class="line">//android.buildTypes.release.ndk.debugSymbolLevel = &#123;SYMBOL_TABLE |FULL &#125;</span><br><span class="line">def DEPEND_CHANNEL = CHANNEL.LZ// CHANNEL.DEFAULT</span><br><span class="line">gradle.startParameter.getTaskNames().each &#123; task -&gt;</span><br><span class="line">    if (task.toLowerCase().contains(&quot;test1&quot;)) &#123;</span><br><span class="line">        DEPEND_CHANNEL = CHANNEL.RUILI</span><br><span class="line">        System.err.println(&quot; current :xxx kemi channel $&#123;task&#125;&quot;)</span><br><span class="line">    &#125; else if (task.toLowerCase().contains(&quot;test&quot;)) &#123;</span><br><span class="line">        DEPEND_CHANNEL = CHANNEL.LZ</span><br><span class="line">        System.err.println(&quot;  current :test channel $&#123;task&#125;&quot;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        DEPEND_CHANNEL = CHANNEL.DEFAULT</span><br><span class="line">        System.err.println(&quot; current :default channel $&#123;task&#125;&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    if (task.toLowerCase().contains(&quot;release&quot;)) &#123;</span><br><span class="line">        isRelease = true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">android &#123;</span><br><span class="line">    flavorDimensions &#x27;myflavor&#x27;</span><br><span class="line">    productFlavors &#123;</span><br><span class="line">        vip &#123;</span><br><span class="line"></span><br><span class="line">            manifestPlaceholders = defaultConfig.manifestPlaceholders + [</span><br><span class="line">//                    GETUI_APPID  : rootProject.ext.GETUI_APPID,</span><br><span class="line">LZ_CHANNEL   : &quot;vip&quot;,</span><br><span class="line">JPUSH_PKGNAME: &quot;com.example.mytest&quot;,</span><br><span class="line">JPUSH_APPKEY : &quot;xxxxxxx&quot;,</span><br><span class="line">JPUSH_CHANNEL: &quot;test_vip&quot;,</span><br><span class="line">            ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            buildConfigField(&quot;String&quot;, &quot;CHANNEL&quot;, &quot;\&quot;vip\&quot;&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            buildConfigField(&quot;int[]&quot;, &quot;MODULES&quot;, &quot;new int[]&#123;0,1,2,3,4,5,6,7,8,9,10,11,12,13&#125;&quot;)</span><br><span class="line">            buildConfigField(&quot;String[]&quot;, &quot;MODULES_NAME&quot;, &quot;&quot;&quot;new String[]&#123;&quot;all&quot;&#125;&quot;&quot;&quot;)</span><br><span class="line">            resValue &quot;string&quot;, &quot;test_channel&quot;, &quot;标准版&quot;</span><br><span class="line">            buildConfigField(&quot;String&quot;, &quot;REGCODE&quot;, &quot;\&quot;\&quot;&quot;)</span><br><span class="line"></span><br><span class="line">            buildConfigField(&quot;String&quot;, &quot;LOGINURL&quot;, &quot;\&quot;http://192.168.1.1\&quot;&quot;)</span><br><span class="line">            buildConfigField(&quot;String&quot;, &quot;LOGINURL2&quot;, &quot;\&quot;http://192.168.1.70\&quot;&quot;)</span><br><span class="line">            applicationId &quot;com.example.mytest&quot;</span><br><span class="line">            dimension &#x27;example&#x27;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        test1 &#123;</span><br><span class="line">            buildConfigField(&quot;String&quot;, &quot;REGCODE&quot;, &quot;\&quot;mycode\&quot;&quot;)</span><br><span class="line">            manifestPlaceholders = defaultConfig.manifestPlaceholders + [GETUI_APPID  : rootProject.ext.GETUI_APPID, LZ_CHANNEL: &quot;test1&quot;,</span><br><span class="line">                                                                         JPUSH_PKGNAME: &quot;com.example.mytest&quot;,</span><br><span class="line">                                                                         JPUSH_APPKEY : &quot;xxxxxxx&quot;,</span><br><span class="line">                                                                         JPUSH_CHANNEL: &quot;test&quot;,</span><br><span class="line">            ]</span><br><span class="line">            buildConfigField(&quot;String&quot;, &quot;LOGINURL&quot;, &quot;\&quot;http://192.168.1.2:8086\&quot;&quot;)</span><br><span class="line">            buildConfigField(&quot;String&quot;, &quot;LOGINURL2&quot;, &quot;\&quot;http://192.168.1.1\&quot;&quot;)</span><br><span class="line">            resValue &quot;string&quot;, &quot;test_channel&quot;, &quot;tt定制版&quot;</span><br><span class="line">//            manifestPlaceholders = [LZ_CHANNEL: &quot;xxx&quot;]</span><br><span class="line">            buildConfigField(&quot;String&quot;, &quot;CHANNEL&quot;, &quot;\&quot;xxx\&quot;&quot;)</span><br><span class="line">            buildConfigField(&quot;int[]&quot;, &quot;MODULES&quot;, &quot;new int[]&#123;0,1,2,3&#125;&quot;)</span><br><span class="line">            buildConfigField(&quot;String[]&quot;, &quot;MODULES_NAME&quot;, &quot;&quot;&quot;new String[]&#123;&quot;box&quot;,&quot;split&quot;,&quot;product&quot;&#125;&quot;&quot;&quot;)</span><br><span class="line">            dimension &#x27;example&#x27;</span><br><span class="line">            applicationIdSuffix &#x27;.xxx&#x27;</span><br><span class="line">            versionNameSuffix &quot;-xxx&quot;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        test &#123;</span><br><span class="line">            manifestPlaceholders = [</span><br><span class="line">                    JPUSH_PKGNAME: &quot;com.example.mytest&quot;,</span><br><span class="line">                    JPUSH_APPKEY : &quot;xxxxxxx&quot;,</span><br><span class="line">                    JPUSH_CHANNEL: &quot;test&quot;,</span><br><span class="line">                    //JPush 上注册的包名对应的 Appkey.</span><br><span class="line">                    GETUI_APPID  : rootProject.ext.GETUI_APPID,</span><br><span class="line">                    LZ_CHANNEL   : &quot;test123&quot;]</span><br><span class="line"></span><br><span class="line">//            manifestPlaceholders = [GETUI_APPID: rootProject.ext.GETUI_APPID, LZ_CHANNEL: &quot;test&quot;]</span><br><span class="line">            buildConfigField(&quot;String&quot;, &quot;CHANNEL&quot;, &quot;\&quot;test\&quot;&quot;)</span><br><span class="line">            buildConfigField(&quot;int[]&quot;, &quot;MODULES&quot;, &quot;new int[]&#123;0,1,2,3,4,5,6,7,8,9,10,11,12,13&#125;&quot;)</span><br><span class="line">            buildConfigField(&quot;String[]&quot;, &quot;MODULES_NAME&quot;, &quot;&quot;&quot;new String[]&#123;&quot;all&quot;&#125;&quot;&quot;&quot;)</span><br><span class="line">            resValue &quot;string&quot;, &quot;test_channel&quot;, &quot;testAPP&quot;</span><br><span class="line">            buildConfigField(&quot;String&quot;, &quot;REGCODE&quot;, &quot;\&quot;test123\&quot;&quot;)</span><br><span class="line">            buildConfigField(&quot;String&quot;, &quot;LOGINURL&quot;, &quot;\&quot;http://192.168.1.1\&quot;&quot;)</span><br><span class="line">            buildConfigField(&quot;String&quot;, &quot;LOGINURL2&quot;, &quot;\&quot;http://192.168.1.2\&quot;&quot;)</span><br><span class="line"></span><br><span class="line">            dimension &#x27;example&#x27;</span><br><span class="line">            applicationId &quot;com.example.mytest&quot;</span><br><span class="line">//            applicationIdSuffix &#x27;.ui&#x27;</span><br><span class="line">            versionNameSuffix &quot;-iview&quot;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    /*  packageOptions &#123;</span><br><span class="line">          exclude [&#x27;testhemaorg_apache_xmlbeans&#x27;]</span><br><span class="line">      &#125;*/</span><br><span class="line">    signingConfigs &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            storeFile file(&quot;example_xxx.jks&quot;)</span><br><span class="line">            storePassword &quot;xxxx&quot;</span><br><span class="line">            keyAlias &quot;xxxx&quot;</span><br><span class="line">            keyPassword &quot;xxx&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    namespace &#x27;com.example.app&#x27;</span><br><span class="line">    configurations &#123; all &#123; exclude module: &#x27;httpclient&#x27; exclude module: &#x27;commons-logging&#x27; &#125; &#125;</span><br><span class="line">    compileSdk 31</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId &quot;com.example.app&quot;</span><br><span class="line">        minSdk 21</span><br><span class="line">        targetSdk 28</span><br><span class="line">        versionCode 3</span><br><span class="line">        versionName rootProject.ext.versionName</span><br><span class="line">        manifestPlaceholders = [</span><br><span class="line">                GETUI_APPID   : rootProject.ext.GETUI_APPID,</span><br><span class="line">                APP_LZHEME    : &quot;example&quot;,</span><br><span class="line">                MEIZU_APPKEY  : &quot;MZ-xx&quot;,</span><br><span class="line">                MEIZU_APPID   : &quot;MZ-xx&quot;,</span><br><span class="line">                XIAOMI_APPID  : &quot;MI-xx&quot;,</span><br><span class="line">                XIAOMI_APPKEY : &quot;MI-xx&quot;,</span><br><span class="line"></span><br><span class="line">                OPPO_APPKEY   : &quot;OP-xx&quot;,</span><br><span class="line">                OPPO_APPID    : &quot;OP-xx&quot;,</span><br><span class="line">                OPPO_APPSECRET: &quot;OP-xx&quot;,</span><br><span class="line">                VIVO_APPKEY   : &quot;xx&quot;,</span><br><span class="line">                VIVO_APPID    : &quot;xx&quot;</span><br><span class="line"></span><br><span class="line">        ]</span><br><span class="line">        resValue &quot;string&quot;, &quot;channel_hard&quot;, &quot;keep&quot;</span><br><span class="line">        buildConfigField &quot;String&quot;, &quot;BUILD_TIME_STR&quot;, &quot;\&quot;&quot; + new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;).format(System.currentTimeMillis()) + &quot;\&quot;&quot;</span><br><span class="line">        buildConfigField(&quot;String&quot;, &quot;VERSION_NAME&quot;, &quot;\&quot;$&#123;versionName&#125;\&quot;&quot;)</span><br><span class="line">        buildConfigField(&quot;boolean&quot;, &quot;DEBUG_&quot;, &quot;false&quot;)</span><br><span class="line">        buildConfigField(&quot;String&quot;, &quot;SERVER_URL&quot;, &quot;\&quot;$&#123;rootProject.ext.SERVER_URL&#125;\&quot;&quot;)</span><br><span class="line">        //请勿在线上版本配置MASTERSECRET的值，避免泄漏</span><br><span class="line">        buildConfigField(&quot;String&quot;, &quot;MASTERSECRET&quot;, &quot;\&quot;\&quot;&quot;)</span><br><span class="line">        buildConfigField(&quot;String&quot;, &quot;APPKEY&quot;, &quot;\&quot;$&#123;rootProject.ext.GETUI_APP_KEY&#125;\&quot;&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        ndk &#123;</span><br><span class="line">            abiFilters &quot;arm64-v8a&quot;, &quot;armeabi-v7a&quot;, &quot;x86&quot;</span><br><span class="line">//            abiFilters &quot;armeabi&quot;, /**/&quot;armeabi-v7a&quot;, &quot;x86_64&quot;, &quot;x86&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        multiDexEnabled true</span><br><span class="line">        testInstrumentationRunner &quot;androidx.test.runner.AndroidJUnitRunner&quot;</span><br><span class="line"></span><br><span class="line">        sourceSets &#123; main &#123; assets.srcDirs = [&#x27;src/main/assets&#x27;] &#125; &#125;</span><br><span class="line">        //指定room.testhemaLocation生成的文件路径 修复警告: Schema export directory is not provided to the annotation processor so we cannot export the testhe 错误，</span><br><span class="line">        javaCompileOptions &#123;</span><br><span class="line">            annotationProcessorOptions &#123;</span><br><span class="line">                arguments = [&quot;room.testhemaLocation&quot;: &quot;$projectDir/testhemas&quot;.toString()]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    buildTypes &#123;</span><br><span class="line"></span><br><span class="line">        debug &#123;</span><br><span class="line">            aaptOptions &#123;</span><br><span class="line">                ignoreAssetsPattern &quot;!testhemaorg_apache_xmlbeans&quot;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            proguardFiles getDefaultProguardFile(&#x27;proguard-android-optimize.txt&#x27;), &#x27;proguard-rules.pro&#x27;</span><br><span class="line">            minifyEnabled false</span><br><span class="line">            signingConfig signingConfigs.release</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        release &#123;</span><br><span class="line">            aaptOptions &#123;</span><br><span class="line">                ignoreAssets &#x27;*.xsd&#x27;</span><br><span class="line">                ignoreAssetsPattern &quot;!testhemaorg_apache_xmlbeans&quot;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            minifyEnabled true</span><br><span class="line">            signingConfig signingConfigs.release</span><br><span class="line">            proguardFiles getDefaultProguardFile(&#x27;proguard-android-optimize.txt&#x27;), &#x27;proguard-rules.pro&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    compileOptions &#123;</span><br><span class="line">        /*    sourceCompatibility JavaVersion.VERSION_1_9</span><br><span class="line">            targetCompatibility JavaVersion.VERSION_1_9*/</span><br><span class="line">        sourceCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">        targetCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    buildFeatures &#123;</span><br><span class="line"></span><br><span class="line">        viewBinding true</span><br><span class="line">        dataBinding true</span><br><span class="line">    &#125;</span><br><span class="line">    def moduleSrcDirs = [</span><br><span class="line">            &quot;accept&quot;, &quot;application&quot;, &quot;demo&quot;, &quot;manager&quot;, &quot;material&quot;, &quot;webview&quot;, &quot;mitest&quot;, &quot;print&quot;, &quot;product&quot;, &#x27;quality&#x27;, &quot;splitmerge&quot;, &quot;zxing&quot;</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    sourceSets &#123;</span><br><span class="line">        main &#123;</span><br><span class="line">            jniLibs.srcDirs = [&#x27;libs&#x27;]</span><br><span class="line">//            exclude &#x27;testhemaorg_apache_xmlbeans/**&#x27;</span><br><span class="line">            res.srcDirs = [&#x27;src/main/res&#x27;, &quot;src/vip/res&quot;]</span><br><span class="line">            moduleSrcDirs.forEach &#123;</span><br><span class="line">                res.srcDirs += &#x27;src/main/java/module/&#x27; + it + &#x27;/res&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        test1 &#123;</span><br><span class="line">            manifest.srcFile &#x27;src/main/java/AndroidManifest.xml&#x27;</span><br><span class="line">            jniLibs.srcDirs = [&#x27;libs&#x27;]</span><br><span class="line">            res.srcDirs = [&#x27;src/main/res&#x27;, &quot;src/test1/res&quot;]</span><br><span class="line">            moduleSrcDirs.forEach &#123;</span><br><span class="line">                res.srcDirs += &#x27;src/main/java/module/&#x27; + it + &#x27;/res&#x27;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        test &#123;</span><br><span class="line">            manifest.srcFile &#x27;src/main/java/AndroidManifest.xml&#x27;</span><br><span class="line">            jniLibs.srcDirs = [&#x27;libs&#x27;]</span><br><span class="line"></span><br><span class="line">            res.srcDirs = [&#x27;src/main/res&#x27;, &quot;src/test/res&quot;]</span><br><span class="line">            moduleSrcDirs.forEach &#123;</span><br><span class="line">                res.srcDirs += &#x27;src/main/java/module/&#x27; + it + &#x27;/res&#x27;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    lintOptions &#123;</span><br><span class="line">        abortOnError false</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //设置强制 更新</span><br><span class="line">    gradle.taskGraph.whenReady &#123; taskGraph -&gt;</span><br><span class="line">        def tasks = taskGraph.getAllTasks()</span><br><span class="line">        tasks.each &#123;</span><br><span class="line">            def taskName = it.getName()</span><br><span class="line">            if (isRelease &amp;&amp; DEPEND_CHANNEL != CHANNEL.DEFAULT) &#123;</span><br><span class="line">                if (taskName == &#x27;compileScReleaseJavaWithJavac&#x27; || taskName == &#x27;processScReleaseMainManifest&#x27;) &#123;</span><br><span class="line">                    print(&quot;found task $taskName\n&quot;)</span><br><span class="line">                    System.err.println(&quot;$&#123;DEPEND_CHANNEL&#125; Found release  $taskName needReleaseBuld&quot;)</span><br><span class="line">                    it.setOnlyIf &#123; true &#125;</span><br><span class="line">                    it.outputs.upToDateWhen &#123; false &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //忽略变体渠道</span><br><span class="line">    variantFilter &#123; variant -&gt;</span><br><span class="line">        def names = variant.flavors*.name</span><br><span class="line">        // To check for a certain build type, use variant.buildType.name == &quot;&lt;buildType&gt;&quot;</span><br><span class="line">        if (names.contains(&quot;test1&quot;) &amp;&amp; names.contains(&quot;debug&quot;)) &#123;</span><br><span class="line">            // Gradle ignores any variants that satisfy the conditions above.</span><br><span class="line">            setIgnore(true)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    applicationVariants.all &#123; variant -&gt;</span><br><span class="line">        variant.getMergeAssetsProvider().configure &#123;</span><br><span class="line">            it.doLast &#123;</span><br><span class="line">                var getMergeAssetsProvider = variant.getMergeAssetsProvider().get()</span><br><span class="line">                System.err.println(&quot;getMergeAssetsProvider  xsb :$&#123;getMergeAssetsProvider.variantName&#125;&quot;);</span><br><span class="line">//test1Debug</span><br><span class="line">                //incrementalFolder</span><br><span class="line">                System.err.println(&quot;delete dir   xsb :$&#123;getMergeAssetsProvider.incrementalFolder&#125;&quot;);</span><br><span class="line">                delete(fileTree(dir: getMergeAssetsProvider.incrementalFolder, includes: [&#x27;*.zip&#x27;, &quot;&#x27;*.xsb&#x27;&quot;]))</span><br><span class="line"></span><br><span class="line">                System.err.println(&quot;getMergeAssetsProvider  xsb :$&#123;getMergeAssetsProvider.incrementalFolder&#125;&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">//        variant.javaCompileProvider</span><br><span class="line">        variant.javaCompileProvider.configure &#123;</span><br><span class="line">            it.doLast &#123;</span><br><span class="line">//                JavaCompile javaCompile=null;</span><br><span class="line">//                if (variant.hasProperty(&#x27;javaCompileProvider&#x27;)) &#123;</span><br><span class="line">                //android gradle 3.3.0 +</span><br><span class="line">                var myprovider = variant.javaCompileProvider.get()</span><br><span class="line">                /* &#125; else &#123;</span><br><span class="line">                     javaCompile = variant.javaCompile</span><br><span class="line">                 &#125;*/</span><br><span class="line">                print(&quot;build dir $&#123;myprovider.destinationDir&#125;\n&quot;);</span><br><span class="line">//                String[] deleteDir = [];</span><br><span class="line">                if (CHANNEL.RUILI == DEPEND_CHANNEL &amp;&amp; isRelease) &#123;</span><br><span class="line"></span><br><span class="line">                    moduleSrcDirs.forEach &#123;</span><br><span class="line">                        if (it.toString() == &quot;splitmerge&quot;</span><br><span class="line">                                || it.toString() == &quot;print&quot;</span><br><span class="line">                                || it.toString() == &quot;product&quot;</span><br><span class="line">                                || it.toString() == &quot;zxing&quot;</span><br><span class="line">                        ) &#123;</span><br><span class="line">                            print(&quot;keep module &quot; + it.toString() + &quot;\n&quot;);</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            String currentDeleteDir = new File(myprovider.destinationDir, &#x27;/module/&#x27; + it + &#x27;&#x27;)</span><br><span class="line">//                            String currentDeleteDir = new File(variant.javaCompile.destinationDir, &#x27;/module/&#x27; + it + &#x27;&#x27;)</span><br><span class="line">                            File file1 = new File(currentDeleteDir)</span><br><span class="line">                            if (file1.exists()) &#123;</span><br><span class="line"></span><br><span class="line">                                file1.deleteDir();</span><br><span class="line">                                print(&quot;delete dir $currentDeleteDir succ!\n&quot;)</span><br><span class="line">                            &#125; else &#123;</span><br><span class="line">                                print(&quot;delete dir $currentDeleteDir fail no exist\n&quot;)</span><br><span class="line"></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; else if (CHANNEL.LZ == DEPEND_CHANNEL &amp;&amp; isRelease) &#123;</span><br><span class="line">                    moduleSrcDirs.forEach &#123;</span><br><span class="line">                        if (it.toString() == &quot;application&quot;</span><br><span class="line">                                || it.toString() == &quot;mitest&quot;</span><br><span class="line">                                || it.toString() == &quot;webview&quot;</span><br><span class="line">                        ) &#123;</span><br><span class="line">                            print(&quot;keep module &quot; + it.toString() + &quot;\n&quot;);</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            String currentDeleteDir = new File(myprovider.destinationDir, &#x27;/module/&#x27; + it + &#x27;&#x27;)</span><br><span class="line">                            File file1 = new File(currentDeleteDir)</span><br><span class="line">                            if (file1.exists()) &#123;</span><br><span class="line">                                file1.deleteDir();</span><br><span class="line">                                print(&quot;delete dir $currentDeleteDir succ!\n&quot;)</span><br><span class="line">                            &#125; else &#123;</span><br><span class="line">                                print(&quot;delete dir $currentDeleteDir fail no exist\n&quot;)</span><br><span class="line"></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    print(&quot;KEEP CHANNEL  MODULE DIR  $DEPEND_CHANNEL&quot;)</span><br><span class="line">                &#125;//字符串加密</span><br><span class="line">                if (&quot;$&#123;myprovider.destinationDir&#125;&quot;.toLowerCase().contains(&quot;release&quot;)) &#123;</span><br><span class="line">                    println(&quot;start classes obfutestation &quot; + &quot;$&#123;myprovider.destinationDir&#125;&quot;)</span><br><span class="line">                    try &#123;</span><br><span class="line">                        javaexec &#123;</span><br><span class="line">                            setDefaultCharacterEncoding(&quot;utf-8&quot;)//这里传错会导致解密出现问题，</span><br><span class="line">                            main(&quot;-jar&quot;)</span><br><span class="line">                            args(</span><br><span class="line">                                    &quot;../obfuseStringGradle.jar&quot;,</span><br><span class="line">                                    project.name,</span><br><span class="line">                                    myprovider.destinationDir,</span><br><span class="line">                                    &quot;../ignore_class.txt&quot;,</span><br><span class="line">                                    ENCRYPT_CONFIG_JSON</span><br><span class="line">                            )</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; catch (e) &#123;</span><br><span class="line">                        e.printStackTrace()</span><br><span class="line">                        println(&quot;exec encrypt fail.. &quot; + &quot;$&#123;e.getMessage()&#125;&quot;)</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    println(&quot;ignore class obfutestation &quot; + &quot;$&#123;myprovider.destinationDir&#125;&quot;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        variant.outputs.each &#123; output -&gt; //every thing example\\app\\build\\.*?AndroidManifest.xml</span><br><span class="line">            output.processManifestProvider.configure &#123;</span><br><span class="line">                it.doLast &#123;</span><br><span class="line"></span><br><span class="line">                    /*  print(&quot;getxx&quot;+output.processManifestProvider.get().singleVariantOutput);</span><br><span class="line">             print(&quot;getxx&quot;+output.processManifestProvider.get().mainMergedManifest.name);</span><br><span class="line">             print(&quot;getxx&quot;+output.processManifestProvider.get().multiApkManifestOutputDirectory.name);*/</span><br><span class="line">//                def cxx=output.processManifestProvider.get().mainManifest;</span><br><span class="line">//                print(cxx);</span><br><span class="line">                    //C:\project\example\app\build\intermediates\merged_manifest\testDebug</span><br><span class="line">                    def manifestPath = new File(&quot;$&#123;buildDir&#125;/intermediates/bundle_manifest/$&#123;variant.dirName&#125;/process$&#123;variant.dirName&#125;Manifest/bundle-manifest/AndroidManifest.xml&quot;)</span><br><span class="line">                    if (!manifestPath.exists()) &#123;</span><br><span class="line">                        manifestPath = new File(&quot;$&#123;buildDir&#125;/intermediates/merged_manifest/$&#123;output.processManifestProvider.get().variantName&#125;/AndroidManifest.xml&quot;)</span><br><span class="line">                    &#125;</span><br><span class="line">                    print(&quot;do clean manifest axml $&#123;manifestPath&#125;&quot;);</span><br><span class="line">//                def manifestPath = &quot;&quot;;//&quot;&quot;&quot;$&#123;manifestOutputDirectory.get()&#125;/AndroidManifest.xml&quot;</span><br><span class="line">//                def manifestPath = &quot;$&#123;manifestOutputDirectory&#125;/AndroidManifest.xml&quot;</span><br><span class="line">//                String manifestPath = &quot;$it.manifestOutputDirectory/AndroidManifest.xml&quot;</span><br><span class="line">                    // Stores the contents of the manifest.</span><br><span class="line">                    def manifestContent = file(manifestPath).getText()</span><br><span class="line">                    print(&quot;manifestPath:&quot; + manifestPath)</span><br><span class="line">                    // Changes the version code in the stored text.</span><br><span class="line">                    manifestContent = manifestContent.replace(&#x27;testtest&#x27;, &quot;fffshit&quot;)</span><br><span class="line">                    // Overwrites the manifest with the new text.</span><br><span class="line">                    file(manifestPath).write(manifestContent)</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compileOnly &#x27;com.android.tools.build:gradle:7.1.2&#x27;</span><br><span class="line">    implementation project(path: &#x27;:third_picture_library&#x27;)//测试查看源码</span><br><span class="line">    implementation &#x27;pub.devrel:easypermissions:3.0.0&#x27; //@depanre</span><br><span class="line"></span><br><span class="line">    vipApi project(path: &#x27;:print&#x27;)</span><br><span class="line">//    testRuntimeOnly(project(path: &#x27;:print&#x27;))</span><br><span class="line">//    testCompileOnly(project(path: &#x27;:print&#x27;))//bug : Didn&#x27;t find class &quot;com.example.print.DataBinderMapperIm</span><br><span class="line">    test1Api project(path: &#x27;:print&#x27;)</span><br><span class="line">    vipApi(project(path: &#x27;:upmaterial&#x27;))</span><br><span class="line">//    testCompileOnly(project(path: &#x27;:upmaterial&#x27;))</span><br><span class="line">//    test1CompileOnly project(path: &#x27;:upmaterial&#x27;)</span><br><span class="line"></span><br><span class="line">    if (DEPEND_CHANNEL == CHANNEL.RUILI) &#123;</span><br><span class="line">/*        compileOnly &#x27;cn.jiguang.sdk:jpush:4.6.3&#x27;  // 此处以JPush 4.5.0 版本为例。</span><br><span class="line">        compileOnly &#x27;cn.jiguang.sdk:jcore:3.1.2&#x27;  // 此处以JCore 3.1.2 版本为例。</span><br><span class="line">        compileOnly &#x27;com.getui:gtsdk:3.2.2.0&#x27;  //个推SDK</span><br><span class="line">        compileOnly &#x27;com.getui:gtc:3.1.4.0&#x27;  //个推核心组件</span><br><span class="line">        */</span><br><span class="line">        compileOnly project(path: &#x27;:third_xc_chartlib&#x27;)</span><br><span class="line">    &#125; else if (DEPEND_CHANNEL == CHANNEL.LZ) &#123;</span><br><span class="line">        print(&quot;test channel--------&quot;)</span><br><span class="line">        compileOnly project(path: &#x27;:base_interface&#x27;)</span><br><span class="line">        implementation project(path: &#x27;:push_table&#x27;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        compileOnly project(path: &#x27;:base_interface&#x27;)</span><br><span class="line">        implementation project(path: &#x27;:push_table&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">    implementation &#x27;com.github.bumptech.glide:glide:4.12.0&#x27;</span><br><span class="line">    kapt &#x27;com.github.bumptech.glide:compiler:4.12.0&#x27;</span><br><span class="line">    implementation(&#x27;com.squareup.okhttp3:logging-interceptor:5.0.0-alpha.3&#x27;) &#123;</span><br><span class="line">        transitive false //阻断里面的okhttp3依赖</span><br><span class="line">    &#125;</span><br><span class="line">    implementation files(&#x27;libs/poishadow-all.jar&#x27;) &#123;</span><br><span class="line">//        exclude module:&#x27;*.xsb&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">//room</span><br><span class="line">    implementation deps.room.runtime</span><br><span class="line">    implementation deps.room.rxjava3</span><br><span class="line">    kapt deps.room.compiler</span><br><span class="line">    api project(path: &#x27;:base&#x27;)</span><br><span class="line">    api project(path: &#x27;:base_mes&#x27;)</span><br><span class="line">    implementation &quot;androidx.startup:startup-runtime:1.1.0&quot;</span><br><span class="line"></span><br><span class="line">    configurations.all &#123;</span><br><span class="line">        resolutionStrategy &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>子module的写法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id &#x27;com.android.library&#x27;</span><br><span class="line">    id &#x27;kotlin-android&#x27;</span><br><span class="line">    id &#x27;kotlin-kapt&#x27;</span><br><span class="line">&#125;</span><br><span class="line">android &#123;</span><br><span class="line">    //包含通知 推送 ，审批？</span><br><span class="line">    namespace &#x27;com.xx.notifiction&#x27;</span><br><span class="line">    compileSdk 32</span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        minSdk 21</span><br><span class="line">        targetSdk 32</span><br><span class="line"></span><br><span class="line">        testInstrumentationRunner &quot;androidx.test.runner.AndroidJUnitRunner&quot;</span><br><span class="line">        consumerProguardFiles &quot;consumer-rules.pro&quot;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled false</span><br><span class="line">            proguardFiles getDefaultProguardFile(&#x27;proguard-android-optimize.txt&#x27;), &#x27;proguard-rules.pro&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sourceSets &#123;</span><br><span class="line">        main &#123;</span><br><span class="line">            jniLibs.srcDirs = [&#x27;libs&#x27;]</span><br><span class="line">            res.srcDirs = [&quot;src/main/java/module/application/res&quot;,  &quot;src/main/res&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    compileOptions &#123;</span><br><span class="line">        sourceCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">        targetCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">    &#125;</span><br><span class="line">    kotlinOptions &#123;</span><br><span class="line">        jvmTarget = &#x27;1.8&#x27;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    buildFeatures &#123;</span><br><span class="line"></span><br><span class="line">        viewBinding true</span><br><span class="line">        dataBinding true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    api(project(path: &#x27;:base&#x27;)) &#123;</span><br><span class="line">        exclude module: &#x27;:base_interface&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">    api(project(path: &#x27;:push_table&#x27;));</span><br><span class="line">    implementation &#x27;androidx.core:core-ktx:1.7.0&#x27;</span><br><span class="line">    implementation &#x27;androidx.appcompat:appcompat:1.3.0&#x27;</span><br><span class="line">    implementation &#x27;com.google.android.material:material:1.4.0&#x27;</span><br><span class="line">    testImplementation &#x27;junit:junit:4.13.2&#x27;</span><br><span class="line">    androidTestImplementation &#x27;androidx.test.ext:junit:1.1.3&#x27;</span><br><span class="line">    androidTestImplementation &#x27;androidx.test.espresso:espresso-core:3.4.0&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>子模块的src&#x2F;main&#x2F;java&#x2F;module&#x2F;application&#x2F;res本来是在主应用中的，我是把application文件夹直接移动过来了，这样重构省事，不乱，随时可以撤回去。</p>
<p>BuildConfig中定义字段法是比较坑爹的，比如里面存放url,但是如果分了那么多模块和databind,那么主buildconfig.class经常不生成，完全可以使用 不同channel不同的相同类 但是不同返回定义值定义法实现。<br>另外需要注意的是同一个application 下可以指定多个res, java,却不能manifest.xml，不然可以简单的进行分离activity清单注册整理，以后再进行模块化</p>
<p>模块划分完毕了还需要处理一个问题叫字符串加密，和代码混淆我刚开始用的第三种方法的，现在行不通了，<br>经过研究发现混淆也可以写绝对路径<br>每一个模块复制这句话就行,不过需要忽略开发工具给的找不到某类的提示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">buildTypes &#123;</span><br><span class="line">    release &#123;</span><br><span class="line">        minifyEnabled true</span><br><span class="line">        proguardFiles getDefaultProguardFile(&#x27;proguard-android-optimize.txt&#x27;), new File(getRootDir().absolutePath+&quot;/app&quot;,&#x27;proguard-rules.pro&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>关于字符串加密的问题，如果每一个模块复制这句话是很麻烦的,最后研究实现了根项目使用全局控制！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">subprojects &#123; project -&gt;</span><br><span class="line">    afterEvaluate &#123;</span><br><span class="line">        final boolean isAndroidLibrary =</span><br><span class="line">                (project.pluginManager.hasPlugin(&#x27;com.android.library&#x27;))</span><br><span class="line">        if (isAndroidLibrary) &#123;</span><br><span class="line">            boolean  ignoreEncrypt;</span><br><span class="line">            var moduleName=project.name;</span><br><span class="line">            switch (moduleName)&#123;</span><br><span class="line">                case &quot;third_xc_chartlib&quot;:</span><br><span class="line">                case &quot;third_print_sdk&quot;:</span><br><span class="line">                case &quot;third_picture_library&quot;:</span><br><span class="line">                case &quot;third_magicindicator&quot;:</span><br><span class="line">                case &quot;third_form&quot;:</span><br><span class="line">                case &quot;third_consecutivescroller&quot;:</span><br><span class="line">                    ignoreEncrypt=true;</span><br><span class="line">                    break;</span><br><span class="line">                    default:</span><br><span class="line">                    ignoreEncrypt=false;</span><br><span class="line">                    break;</span><br><span class="line">            &#125;</span><br><span class="line">            if(ignoreEncrypt)&#123;</span><br><span class="line">            System.err.println(&quot;library-ignore-encrypt------&quot;+project.name);</span><br><span class="line">                return;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">            System.err.println(&quot;library-need-encrypt-str&quot;+project.name);</span><br><span class="line">            &#125;</span><br><span class="line">            android &#123;</span><br><span class="line">                libraryVariants.all &#123; variant -&gt;</span><br><span class="line">                    variant.javaCompileProvider.configure &#123;</span><br><span class="line">                        it.doLast &#123;</span><br><span class="line">                            System.err.println  &quot;module[$&#123;project.name&#125;]Encrypt&quot;//</span><br><span class="line">                            var myprovider = variant.javaCompileProvider.get()</span><br><span class="line">                            print(&quot;build dir $&#123;myprovider.destinationDir&#125;\n&quot;);</span><br><span class="line">                            if (&quot;$&#123;myprovider.destinationDir&#125;&quot;.toLowerCase().contains(&quot;release&quot;)) &#123;</span><br><span class="line">                                println(&quot;start module classes obfuscation &quot; + &quot;$&#123;myprovider.destinationDir&#125;&quot;)</span><br><span class="line">                                try &#123;</span><br><span class="line">                                    javaexec &#123;</span><br><span class="line">                                        setDefaultCharacterEncoding(&quot;utf-8&quot;)//这里传错会导致解密出现问题，</span><br><span class="line">                                        main(&quot;-jar&quot;)</span><br><span class="line">                                        args(</span><br><span class="line">                                                &quot;$&#123;getRootDir().absolutePath&#125;\\obnew.jar&quot;,</span><br><span class="line">                                                project.name,</span><br><span class="line">                                                myprovider.destinationDir,</span><br><span class="line">                                                &quot;$&#123;getRootDir().absolutePath&#125;/ignore_class.txt&quot;,</span><br><span class="line">                                                ENCRYPT_MODULE_JSON</span><br><span class="line">                                        )</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125; catch (e) &#123;</span><br><span class="line">                                    e.printStackTrace()</span><br><span class="line">                                    System.err.println(&quot;exec encrypt fail.. &quot; + &quot;$&#123;e.getMessage()&#125;&quot;)</span><br><span class="line">                                &#125;</span><br><span class="line"></span><br><span class="line">                            &#125; else &#123;</span><br><span class="line">                                println(&quot;notReleaseApk,ignore class obfuscation &quot; + &quot;$&#123;myprovider.destinationDir&#125;&quot;)</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            System.err.println(&quot;other library-------&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        dependencies &#123;</span><br><span class="line">            if (isAndroidLibrary) &#123;</span><br><span class="line">                // android dependencies here</span><br><span class="line">            &#125;</span><br><span class="line">            // all subprojects dependencies here</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>obnew.jar是加密工具类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ENCRYPT_MODULE_JSON = &quot;&#123;\\\&quot;ignoreUseSimpleEncrypt\\\&quot;:true,&quot; +</span><br><span class="line">        &quot;\\\&quot;onlydebug\\\&quot;:false,&quot; +</span><br><span class="line">        &quot;\\\&quot;EncryptClassSign\\\&quot;:\\\&quot;com/xxx/app/encrypt/no_no\\\&quot;,&quot; +</span><br><span class="line">        &quot;\\\&quot;SimpleEncryptClassSign\\\&quot;:\\\&quot;com/xxx/app/encrypt/no_no\\\&quot;,&quot; +</span><br><span class="line">        &quot;\\\&quot;simpleEncryptMethod\\\&quot;:\\\&quot;call\\\&quot;,&quot; +</span><br><span class="line">        &quot;\\\&quot;mode\\\&quot;:\\\&quot;str_wrap\\\&quot;,&quot; +</span><br><span class="line">        &quot;\\\&quot;module\\\&quot;:true,&quot; +</span><br><span class="line">        &quot;\\\&quot;loglevel\\\&quot;:2,&quot; +</span><br><span class="line">        &quot;\\\&quot;dexProguard\\\&quot;:0,&quot; +</span><br><span class="line">        &quot;\\\&quot;soEncryptMethod\\\&quot;:\\\&quot;call1\\\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure>

<p>如果非是 aa bb的包名就跳过加密字符串<br><code>^((?!aa|bb).)*$</code></p>
<p>另外全局控制gradle task的也有如下方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">getRootProject().getAllprojects().forEach&#123;</span><br><span class="line">    project-&gt;</span><br><span class="line">        project.getTasksByName(&quot;javaPreCompileRelease&quot;,true).forEach&#123;</span><br><span class="line"></span><br><span class="line">            task-&gt;task.doLast&#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"></span><br><span class="line"> * 配置阶段完成以后的监听回调</span><br><span class="line"></span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">this.afterEvaluate &#123;</span><br><span class="line">    //和        variant.javaCompileProvider.configure  一起执行</span><br><span class="line">    System.err.println  &#x27;配置阶段执行完毕&#x27;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"></span><br><span class="line"> * gradle 执行完毕的回调监听</span><br><span class="line"></span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">this.gradle.buildFinished &#123;</span><br><span class="line"></span><br><span class="line">    System.err.println &#x27;----------执行阶段执行完毕&#x27;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">applicationVariants.all &#123; variant -&gt;</span><br><span class="line">    variant.getMergeAssetsProvider().configur</span><br><span class="line">    variant.javaCompileProvider.configure</span><br><span class="line">    variant.outputs.each</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>上面的if else  impl 对应的写法实际上还是有一些问题的，也是网上我找到的方法，但是这种方法会导致编译器在识别的时候不会报红色，什么意思呢，就是没有走这个逻辑，理论上是找不到这个类的，但是看不到详细信息， 只有在你实际编译的过程中才知道错误<br>那么正确的写法是什么呢？<br>如果是vipChannel 则应该这么写<code> vipImplements</code></p>
<p>下面是kts的写法 而gradle是不用括号的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">  vipApi(project(&quot;:accept&quot;))</span><br><span class="line"> vipApi(project(&quot;:quality&quot;))</span><br><span class="line"> vipApi(project(&quot;:product&quot;))</span><br><span class="line"> vipApi(project(&quot;:webapi&quot;))</span><br><span class="line"> vipApi(project(&quot;:print&quot;))</span><br><span class="line"> vipApi(project(&quot;:solider&quot;)</span><br><span class="line"> vipApi(project(&quot;:upmaterial&quot;))</span><br><span class="line"> vipApi(project(&quot;:uisc&quot;))</span><br><span class="line"> vipApi(project(&quot;:push_table&quot;))</span><br><span class="line"> vipApi(project(&quot;:base_mes&quot;))</span><br><span class="line"> //A公司</span><br><span class="line">aaaApi(project(&quot;:product&quot;))</span><br><span class="line">aaaApi(project(&quot;:webapi&quot;))</span><br><span class="line">aaaApi(project(&quot;:base_mes&quot;))</span><br><span class="line">aaaApi(project(&quot;:print&quot;))</span><br><span class="line"> //B公司只需要推送相关</span><br><span class="line"> bbApi(project(&quot;:push_table&quot;))</span><br><span class="line"> bbApi(project(&quot;:uisc&quot;))</span><br></pre></td></tr></table></figure>
<p>上面  vip是完整版，包含了product ,也包含了 push_table, </p>
<p>2022-6-15 13:57:03</p>
<p>上面的写法是基于gradle,写法，而kts实际上都已经实现了，暂时不发布教程</p>
</div></article></div><div class="right-container"><div class="widget"><div class="category"><h4>分类归档</h4><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android-bug%E5%BC%82%E5%B8%B8%E4%B8%8E%E8%A7%A3%E5%86%B3/">Android-bug异常与解决</a><span class="category-list-count">80</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Blog/">Blog</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Photo/">Photo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/QQ%E6%8A%80%E5%B7%A7/">QQ技巧</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/andorid%E8%A7%A6%E6%91%B8%E4%B8%8E%E6%BB%91%E5%8A%A8/">andorid触摸与滑动</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a><span class="category-list-count">148</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android-System/">android-System</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/androidUi%E5%B7%A9%E5%9B%BA%E7%AC%94%E8%AE%B0/">androidUi巩固笔记</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/androidtv%E5%BC%80%E5%8F%91/">androidtv开发</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android%E5%8A%A8%E7%94%BB/">android动画</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android%E6%8F%92%E4%BB%B6%E5%8C%96/">android插件化</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android%E6%9E%B6%E6%9E%84%E5%B8%88%E8%BF%9B%E9%98%B6/">android架构师进阶</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">android源码分析</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%8E%E5%9B%BE%E5%BD%A2%E7%BB%98%E5%88%B6/">android自定义与图形绘制</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c/">c#</a><span class="category-list-count">43</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-JNI-Ndk/">c-c---JNI-Ndk</a><span class="category-list-count">88</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/eclipse/">eclipse</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/gradle/">gradle</a><span class="category-list-count">24</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ide%E6%8A%80%E5%B7%A7/">ide技巧</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kotlin-with-java/">kotlin-with-java</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mac-ios/">mac-ios</a><span class="category-list-count">29</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell-bat-lua%E8%84%9A%E6%9C%AC/">shell-bat-lua脚本</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/window/">window</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%8A%E8%BD%A6/">上车</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%AC%E5%91%8A/">公告</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8A%9E%E5%85%AC/">办公</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9C%B0%E7%90%83/">地球</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9C%B0%E7%90%83/%E4%B8%AD%E5%9B%BD/">中国</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9C%B0%E7%90%83/%E4%B8%AD%E5%9B%BD/%E6%B9%96%E5%8D%97/">湖南</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9C%B0%E7%90%83/%E4%B8%AD%E5%9B%BD/%E6%B9%96%E5%8D%97/%E5%A8%84%E5%BA%95/">娄底</a><span class="category-list-count">1</span></li></ul></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9E%83%E5%9C%BE%E5%A0%86/">垃圾堆</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7/">奇淫技巧</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%8A%80%E5%B7%A7/">小程序技巧</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%83%85%E8%BF%81QQ%E6%9C%BA%E5%99%A8%E4%BA%BA/">情迁QQ机器人</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%83%85%E8%BF%81%E8%BD%AF%E4%BB%B6/">情迁软件</a><span class="category-list-count">39</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%89%93%E8%B5%8F/">打赏</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E5%AD%A6/">数学</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A5%E8%AE%B0%E6%9C%AC/">日记本</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B1%87%E7%BC%96/">汇编</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%8B%E8%AF%95/">测试</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%8B%E8%AF%95%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/">测试与自动化</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">游戏开发</a><span class="category-list-count">39</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/">版本控制</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB/">生活</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A1%AC%E4%BB%B6%E7%BB%B4%E4%BF%AE/">硬件维修</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A7%91%E5%B9%BB/">科幻</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E6%95%B0%E5%AD%A6%E9%97%AE%E9%A2%98/">程序员的数学问题</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E6%9D%82%E9%A1%B9/">编程杂项</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%AB%99%E5%BB%BA%E8%AE%BE/">网站建设</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BE%8E%E5%A5%B3/">美女</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BF%BB%E8%AF%91%E8%A7%86%E9%A2%91%E6%95%99%E7%A8%8B/">翻译视频教程</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%B0%E5%BF%86/">记忆</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B7%A8%E5%B9%B3%E5%8F%B0app/">跨平台app</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B7%AF%E7%94%B1%E5%99%A8/">路由器</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%80%86%E5%90%91/">逆向</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%80%86%E5%90%91%E4%B8%8E%E5%AE%89%E5%85%A8/">逆向与安全</a><span class="category-list-count">85</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9A%8F%E7%AC%94/">随笔</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%A2%E8%AF%95%E6%94%BB%E5%85%8B/">面试攻克</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86/">音视频处理</a><span class="category-list-count">7</span></li></ul></div></div><div class="widget"><div class="tagcloud"><h4>标签云</h4><a href="/tags/Android-bug%E5%BC%82%E5%B8%B8%E4%B8%8E%E8%A7%A3%E5%86%B3/" style="font-size: 18.46px;">Android-bug异常与解决</a> <a href="/tags/CDN/" style="font-size: 10px;">CDN</a> <a href="/tags/Git/" style="font-size: 10.38px;">Git</a> <a href="/tags/JAVA/" style="font-size: 10px;">JAVA</a> <a href="/tags/Lua/" style="font-size: 10px;">Lua</a> <a href="/tags/QQ%E6%8A%80%E5%B7%A7/" style="font-size: 10px;">QQ技巧</a> <a href="/tags/WEB/" style="font-size: 10.38px;">WEB</a> <a href="/tags/andorid%E8%A7%A6%E6%91%B8%E4%B8%8E%E6%BB%91%E5%8A%A8/" style="font-size: 13.08px;">andorid触摸与滑动</a> <a href="/tags/android/" style="font-size: 20px;">android</a> <a href="/tags/android-studio/" style="font-size: 10px;">android studio</a> <a href="/tags/android-System/" style="font-size: 15.38px;">android-System</a> <a href="/tags/androidUi%E5%B7%A9%E5%9B%BA%E7%AC%94%E8%AE%B0/" style="font-size: 11.54px;">androidUi巩固笔记</a> <a href="/tags/androidtv%E5%BC%80%E5%8F%91/" style="font-size: 10.38px;">androidtv开发</a> <a href="/tags/android%E5%8A%A8%E7%94%BB/" style="font-size: 10px;">android动画</a> <a href="/tags/android%E6%8F%92%E4%BB%B6%E5%8C%96/" style="font-size: 14.23px;">android插件化</a> <a href="/tags/android%E6%9E%B6%E6%9E%84%E5%B8%88%E8%BF%9B%E9%98%B6/" style="font-size: 10.38px;">android架构师进阶</a> <a href="/tags/android%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" style="font-size: 12.31px;">android源码分析</a> <a href="/tags/android%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%8E%E5%9B%BE%E5%BD%A2%E7%BB%98%E5%88%B6/" style="font-size: 16.15px;">android自定义与图形绘制</a> <a href="/tags/c/" style="font-size: 18.08px;">c#</a> <a href="/tags/c-c-JNI-Ndk/" style="font-size: 19.23px;">c-c---JNI-Ndk</a> <a href="/tags/consectetur/" style="font-size: 10px;">consectetur</a> <a href="/tags/eclipse/" style="font-size: 12.31px;">eclipse</a> <a href="/tags/git/" style="font-size: 12.69px;">git</a> <a href="/tags/gradle/" style="font-size: 16.92px;">gradle</a> <a href="/tags/ide%E6%8A%80%E5%B7%A7/" style="font-size: 16.54px;">ide技巧</a> <a href="/tags/java/" style="font-size: 15px;">java</a> <a href="/tags/kotlin-with-java/" style="font-size: 16.15px;">kotlin-with-java</a> <a href="/tags/linux/" style="font-size: 11.15px;">linux</a> <a href="/tags/mac-ios/" style="font-size: 17.31px;">mac-ios</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/php/" style="font-size: 13.08px;">php</a> <a href="/tags/python/" style="font-size: 15.38px;">python</a> <a href="/tags/shell-bat-lua%E8%84%9A%E6%9C%AC/" style="font-size: 12.31px;">shell-bat-lua脚本</a> <a href="/tags/window/" style="font-size: 13.85px;">window</a> <a href="/tags/xposed%E6%8F%92%E4%BB%B6/" style="font-size: 10px;">xposed插件</a> <a href="/tags/%E4%B8%83%E7%89%9B/" style="font-size: 10px;">七牛</a> <a href="/tags/%E4%B8%8A%E8%BD%A6/" style="font-size: 11.92px;">上车</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99/" style="font-size: 10px;">代码编写</a> <a href="/tags/%E5%85%8DRoot/" style="font-size: 10px;">免Root</a> <a href="/tags/%E5%85%AC%E5%91%8A/" style="font-size: 11.15px;">公告</a> <a href="/tags/%E5%88%86%E8%BA%AB%E5%A4%A7%E5%B8%88/" style="font-size: 10px;">分身大师</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 12.69px;">前端</a> <a href="/tags/%E5%8A%9E%E5%85%AC/" style="font-size: 10px;">办公</a> <a href="/tags/%E5%90%8E%E7%AB%AF/" style="font-size: 10px;">后端</a> <a href="/tags/%E5%9B%BE%E7%89%87/" style="font-size: 10px;">图片</a> <a href="/tags/%E5%9E%83%E5%9C%BE%E5%A0%86/" style="font-size: 14.23px;">垃圾堆</a> <a href="/tags/%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7/" style="font-size: 13.46px;">奇淫技巧</a> <a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%8A%80%E5%B7%A7/" style="font-size: 14.23px;">小程序技巧</a> <a href="/tags/%E6%83%85%E8%BF%81QQ%E6%9C%BA%E5%99%A8%E4%BA%BA/" style="font-size: 10px;">情迁QQ机器人</a> <a href="/tags/%E6%83%85%E8%BF%81%E8%BD%AF%E4%BB%B6/" style="font-size: 17.69px;">情迁软件</a> <a href="/tags/%E6%89%93%E8%B5%8F/" style="font-size: 10px;">打赏</a> <a href="/tags/%E6%8F%92%E4%BB%B6/" style="font-size: 10px;">插件</a> <a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 11.92px;">数学</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 11.54px;">数据库</a> <a href="/tags/%E6%97%A5%E8%AE%B0%E6%9C%AC/" style="font-size: 10.77px;">日记本</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E4%BA%BA/" style="font-size: 10px;">机器人</a> <a href="/tags/%E6%B1%87%E7%BC%96/" style="font-size: 10px;">汇编</a> <a href="/tags/%E6%B5%8B%E8%AF%95%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/" style="font-size: 10.38px;">测试与自动化</a> <a href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/" style="font-size: 17.69px;">游戏开发</a> <a href="/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" style="font-size: 10.38px;">版本控制</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 14.62px;">生活</a> <a href="/tags/%E7%A1%AC%E4%BB%B6%E7%BB%B4%E4%BF%AE/" style="font-size: 10.38px;">硬件维修</a> <a href="/tags/%E7%A7%91%E5%B9%BB/" style="font-size: 10px;">科幻</a> <a href="/tags/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E6%95%B0%E5%AD%A6%E9%97%AE%E9%A2%98/" style="font-size: 13.08px;">程序员的数学问题</a> <a href="/tags/%E7%BC%96%E7%A8%8B%E6%9D%82%E9%A1%B9/" style="font-size: 15.77px;">编程杂项</a> <a href="/tags/%E7%BF%BB%E8%AF%91%E8%A7%86%E9%A2%91%E6%95%99%E7%A8%8B/" style="font-size: 10px;">翻译视频教程</a> <a href="/tags/%E8%97%8F%E5%93%81/" style="font-size: 19.62px;">藏品</a> <a href="/tags/%E8%A7%86%E9%A2%91/" style="font-size: 10px;">视频</a> <a href="/tags/%E8%AE%B0%E5%BF%86/" style="font-size: 11.15px;">记忆</a> <a href="/tags/%E8%B7%A8%E5%B9%B3%E5%8F%B0app/" style="font-size: 13.85px;">跨平台app</a> <a href="/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/" style="font-size: 11.92px;">路由器</a> <a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 10px;">逆向</a> <a href="/tags/%E9%80%86%E5%90%91%E4%B8%8E%E5%AE%89%E5%85%A8/" style="font-size: 18.85px;">逆向与安全</a> <a href="/tags/%E9%93%BE%E6%8E%A5/" style="font-size: 10.38px;">链接</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 11.54px;">随笔</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E6%94%BB%E5%85%8B/" style="font-size: 10.38px;">面试攻克</a> <a href="/tags/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86/" style="font-size: 12.31px;">音视频处理</a></div></div><div class="widget"><div class="recent"><h4>最近文章</h4><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/09/06/%E7%89%A9%E4%BD%93%E6%B0%B8%E8%BF%9C%E9%9D%A2%E5%90%91%E7%9B%B8%E6%9C%BA%EF%BC%8C%E4%BD%86%E6%98%AFx%E8%BD%B4%E4%B8%8D%E5%8F%98%E5%8C%96/">物体永远面向相机，但是x轴不变化</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/06/-net-web-api-json%E5%8F%82%E6%95%B0%E9%94%99%E8%AF%AF%E7%9A%84json%E6%A0%BC%E5%BC%8F%E5%92%8C%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E5%93%8D%E5%BA%94%E7%A0%81%E5%AE%9A%E5%88%B6/">netwebapijson参数错误的json格式和返回结果响应码定制</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/04/%5B%E9%80%86%E5%90%91%E5%AD%A6%E4%B9%A0%E6%B3%95%5D%E6%97%A0%E6%BA%90%E7%A0%81%E9%80%9A%E8%BF%87%E4%B8%A4%E4%B8%AA%E6%BA%90%E7%A0%81%E6%AF%94%E8%BE%83%E7%A0%94%E7%A9%B6%E8%B7%AF%E7%94%B1%E5%99%A82%E5%A4%A9%E6%90%9E%E5%AE%9Angrok%E7%A6%BB%E7%BA%BF%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/">逆向学习法无源码通过两个源码比较研究路由器2天搞定ngrok离线插件开发</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/01/%E4%B8%A4%E4%B8%AA%E5%8C%85%E5%90%8D%E5%89%8D%E7%BC%80%E7%9B%B8%E8%BF%91%E8%8E%B7%E5%8F%96%E6%9C%80%E6%96%B0%E5%AE%89%E8%A3%85%E7%9A%84%E5%8C%85%E5%90%8D%E6%96%B9%E6%B3%95/">两个包名前缀相近获取最新安装的包名方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/01/asp-net-core-api--%E7%AD%89%E8%B0%83%E7%94%A8webservice%E4%BB%A5%E5%8F%8A-%E5%A4%84%E7%90%86%E8%BF%94%E5%9B%9E%E5%80%BC%E8%B8%A9%E5%9D%91%E4%B9%8B%E8%B7%AF/">aspnetcoreapi等调用webservice以及处理返回值踩坑之路</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/24/c#%E8%83%BD%E5%90%A6%E5%92%8Cc++%E4%B8%80%E6%A0%B7%E5%BF%AB%E4%B9%90%E7%9A%84%E5%A4%9A%E6%B8%A0%E9%81%93%E7%BC%96%E8%AF%91%E5%91%A2%EF%BC%9F%E5%AE%8F%E5%AE%9A%E4%B9%89%E5%85%A8%E5%B1%80%E7%A0%94%E7%A9%B6/">c能否和c一样快乐的多渠道编译呢？宏定义全局研究</a></li></ul></div></div><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/2022/06/16/%E6%91%A9%E6%AF%94%E4%BF%A1%E9%80%9AMobydata-%E5%BC%80%E5%8F%91%E8%80%85%E6%A8%A1%E5%BC%8F%E5%AF%86%E7%A0%81/" class="prev">PREV</a><a href="/2022/06/14/kts%E4%BB%A3%E6%9B%BFgradle%E5%8D%87%E7%BA%A7%E6%8C%87%E5%8D%97%E9%AB%98%E9%98%B6%E7%8E%A9%E6%B3%95/" class="next">NEXT</a></div><!--PC和WAP自适应版--><div id="SOHUCS" sid="2022/06/15/模块化项目架构笔记高级技巧-拦截所有模块实现字符串加密编译/"> </div><script>(function() {
    var appid = 'cytVgXm93'; 
    var conf = 'e46b9c0a4ede5c70e062020c1d3651e1';
    var width = window.innerWidth || document.documentElement.clientWidth; 
    if (width < 960) { 
    window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })();</script><div class="copyright"><p>© 2015 - 2022 <a target="_blank">情随事迁</a>, 微博 <a href="https://weibo.com/qssq666" target="_blank">qssq666</a> <br>  <a href="https://space.bilibili.com/101043764?spm_id_from=333.1007.0.0" target="_blank">bilibli</a>  <a href="https://www.jianshu.com/u/9b0768e66d01" target="_blank">简书</a></p><p>总计访问量 <i data-hk-site="-"></i></p></div><div class="totop"><i></i></div></div></footer>
<script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="http://apps.bdimg.com/libs/jquery/1.8.2/jquery.min.js"></script><script src="/scripts/av-min-1.5.0.js"></script><script src="/scripts/hit-kounter-lc-0.3.0.js"></script><script src="/scripts/arAnchor.js"></script><script src="/scripts/main.js"></script></body></html>