<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content=""><meta name="google-site-verification" content="UKlpQSB6IlVlxjxgprQbTNRUiLE1BnpIV5zeQ_MYkks"><title> 荣耀84g选择了3g卡导致默认数据重启后自动跟随bug研究分析以及编写xposed修复bug · 情迁博客</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="荣耀84g选择了3g卡导致默认数据重启后自动跟随bug研究分析以及编写xposed修复bug - 情随事迁"><meta name="keywords"><meta name="author" content="情随事迁"><meta name="referrer" content="no-referrer"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="https://lozn.top/atom.xml" title="情迁博客"><meta name="generator" content="Hexo 5.4.1"></head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="/images/logo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="https://godhand.lozn.top" target="_blank" data-hover="神之手" class="nav-list-link">神之手</a></li><li class="nav-list-item"><a href="https://robot.lozn.top" target="_blank" data-hover="机器人" class="nav-list-link">机器人</a></li><li class="nav-list-item"><a href="/categories/情迁软件/" target="_self" data-hover="情迁" class="nav-list-link">情迁</a></li><li class="nav-list-item"><a href="https://www.jianshu.com/u/9b0768e66d01" target="_blank" data-hover="简书" class="nav-list-link">简书</a></li><li class="nav-list-item"><a href="/update/" target="_self" data-hover="下载" class="nav-list-link">下载</a></li><li class="nav-list-item"><a href="/about/" target="_self" data-hover="关于" class="nav-list-link">关于</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page --><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">荣耀84g选择了3g卡导致默认数据重启后自动跟随bug研究分析以及编写xposed修复bug</h1><div class="post-info">2018-07-15<p class="visit"><i data-hk-page="current">Loading</i><span>次访问</span></p></div><div class="post-content"><p>简书链接:<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/0eee9e47b14e">荣耀84g选择了3g卡导致默认数据重启后自动跟随bug研究分析以及编写xposed修复bug</a><br>文章字数：2051,阅读全文大约需要8分钟<br>反馈过荣耀官方很多次，这次打电话说确实有bug,说已经更新了，等更新，我特么等了快1个月了。。于是无奈自己分析了.</p>
<p>我其实也是比较懒的,但是现在的情况是红米note4x压根不能让我的联通3g卡用于接听，让另外一张卡用于上网，荣耀也有bug,但是至少可以让我得另外一张上网的4g卡可以上网，只是关机自动还原，扣费扣得非常惨，因为这个问题搞的我欠费很多次了，这方便比如小米了，小米是设置没毛病，就是没信号。</p>
<p>首先我的荣耀8root了，所以找起来比较简单<br>apk是双卡管理_com.huawei.android.dsdscardmanager_3.0.5.14_build3050.apk<br>根据文件字符串和选择框特征定位到class <code>HWCardManagerPrefsFragment</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">private void initPreferences() &#123;</span><br><span class="line">    addPreferencesResource();</span><br><span class="line">    PreferenceScreen screen = getPreferenceScreen();</span><br><span class="line">    this.mDataEnablePreference = (SwitchPreference) screen.findPreference(&quot;data_enabled&quot;);</span><br><span class="line">    this.mDataEnablePreference.setOnPreferenceChangeListener(this);</span><br><span class="line">    screen.removePreference(this.mDataEnablePreference);</span><br><span class="line">    this.mDefault4GSlotPreference = (CardSelectPreference) screen.findPreference(&quot;switch_dual_card_slots&quot;);</span><br><span class="line">    if (Constants.IS_4G_DATA_BIND) &#123;</span><br><span class="line">        this.mDefault4GSlotPreference.setTitle(R.string.default_data_network_emui);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        this</span><br></pre></td></tr></table></figure>

<p>如何定位的呢,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ing name=&quot;card2_manual_select_network_telecomiot&quot;&gt;卡槽二手动选网&lt;/string&gt;</span><br><span class="line">    &lt;string name=&quot;card1_manual_select_network_telecomiot&quot;&gt;卡槽一手动选网&lt;/string&gt;</span><br><span class="line">    &lt;string name=&quot;switch_dual_card_slots_emui&quot;&gt;4G/3G 卡槽选择&lt;/string&gt;</span><br><span class="line">    &lt;string name=&quot;switch_dual_card_slots_emui&quot;&gt;电信4G/3G卡槽&lt;/string&gt;</span><br><span class="line">    &lt;string name=&quot;set_sdcs_failed_emui&quot;&gt;4G/3G 卡槽切换失败&lt;/string&gt;</span><br><span class="line">    &lt;string name=&quot;set_sdcs_failed_emui&quot;&gt;电信4G/3G卡槽设置失败&lt;/string&gt;</span><br><span class="line">    &lt;string name=&quot;switch_dual_card_slots_summary_emui&quot;&gt;此卡槽支持更多频段及更好的网络信号&lt;/string&gt;</span><br><span class="line">    &lt;string name=&quot;dualcard_switch_alert_title_emui&quot;&gt;4G/3G 卡槽选择&lt;/string&gt;</span><br><span class="line">    &lt;string name=&quot;dualcard_switch_alert_title_emui&quot;&gt;电信4G/3G卡槽选择&lt;/string&gt;</span><br><span class="line">    &lt;string name=&quot;sim_card_name&quot;&gt;卡名称&lt;/string&gt;</span><br><span class="line">    &lt;string name=&quot;default_data_network_emui&quot;&gt;默认移动数据&lt;/string&gt;</span><br><span class="line">    &lt;string name=&quot;deactivating_card_conform&quot;&gt;此操作将导致%s 不可用，是否继续？&lt;/stri</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">![img](https://upload-images.jianshu.io/upload_images/2815884-ba25cfb909460674.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/500)</span><br><span class="line"></span><br><span class="line">要做的是编写一个系统程序，开机后自动重新设置一遍，这样的话泄露的流量就不会太多了，之前是网上找过相关设置默认移动数据的教程，发现并不行，出现什么invvxxexception，应该是没找到class了。</span><br><span class="line"></span><br><span class="line">整体源码如下</span><br></pre></td></tr></table></figure>
<p>package com.huawei.android.dsdscardmanager.fragments;</p>
<p>import android.app.Activity;<br>import android.content.Context;<br>import android.content.Intent;<br>import android.os.Bundle;<br>import android.os.SystemProperties;<br>import android.preference.Preference;<br>import android.preference.Preference.OnPreferenceChangeListener;<br>import android.preference.Preference.OnPreferenceClickListener;<br>import android.preference.PreferenceScreen;<br>import android.preference.SwitchPreference;<br>import android.provider.Settings.Global;<br>import android.text.TextUtils;<br>import android.view.ContextThemeWrapper;<br>import android.view.LayoutInflater;<br>import android.view.MotionEvent;<br>import android.view.View;<br>import android.view.View.OnClickListener;<br>import android.view.View.OnTouchListener;<br>import android.view.ViewGroup;<br>import android.widget.CompoundButton;<br>import android.widget.CompoundButton.OnCheckedChangeListener;<br>import android.widget.LinearLayout;<br>import android.widget.ListView;<br>import android.widget.RelativeLayout;<br>import android.widget.TextView;<br>import com.huawei.android.dsdscardmanager.CallForwardingManagerActivity;<br>import com.huawei.android.dsdscardmanager.Constants;<br>import com.huawei.android.dsdscardmanager.HWCardManagerActivity;<br>import com.huawei.android.dsdscardmanager.HwCustCardManagerActivity;<br>import com.huawei.android.dsdscardmanager.HwLog;<br>import com.huawei.android.dsdscardmanager.HwVsimUtils;<br>import com.huawei.android.dsdscardmanager.ItemUseStat;<br>import com.huawei.android.dsdscardmanager.MLog;<br>import com.huawei.android.dsdscardmanager.R;<br>import com.huawei.android.dsdscardmanager.Utils;<br>import com.huawei.android.dsdscardmanager.model.Card;<br>import com.huawei.android.dsdscardmanager.model.CardManager;<br>import com.huawei.android.dsdscardmanager.utils.CallForwardingManager;<br>import com.huawei.android.dsdscardmanager.widget.CallForwardingPreference;<br>import com.huawei.android.dsdscardmanager.widget.CardSelectPreference;<br>import com.huawei.android.dsdscardmanager.widget.CardView;<br>import com.huawei.android.dsdscardmanager.widget.PreferenceCategoryug;<br>import com.huawei.android.dsdscardmanager.widget.TipToastManager;<br>import com.huawei.android.telephony.TelephonyManagerEx;</p>
<p>public class HWCardManagerPrefsFragment extends InstrumentedFragment implements OnPreferenceChangeListener, OnPreferenceClickListener {<br>    private static final int CDMA_MODE &#x3D; 0;<br>    public static final boolean IS_FULL_NETWORK_SUPPORTED &#x3D; SystemProperties.getBoolean(“ro.config.all_network_4Gswitch”, false);<br>    private static final boolean NOT_INSERT_CARD_BOTH_2G_3G_4G &#x3D; SystemProperties.getBoolean(“ro.config.hw_both_2g3g4g”, false);<br>    private static final String PREF_KEY_CALL_FORWARDING_ENABLE &#x3D; “call_forwarding_enable”;<br>    private static final String PREF_KEY_CALL_FORWARDING_ENABLE_DIVIDER &#x3D; “call_forwarding_enable_divider”;<br>    private static final String PREF_KEY_CARD_AND_DATA_DIVIDER &#x3D; “card_and_data_divider”;<br>    private static final String PREF_KEY_DATA_ENABLED &#x3D; “data_enabled”;<br>    private static final String PREF_KEY_DEFAULT_CARD_MODE &#x3D; “default_card_mode”;<br>    private static final String PREF_KEY_DEFAULT_DATA_NETWORK &#x3D; “default_data_network”;<br>    private static final String PREF_KEY_DSDS_PREFERENCE_CATEGORY &#x3D; “dsds_preference_category”;<br>    private static final String PREF_KEY_SWITCH_DUAL_CARD_SLOTS &#x3D; “switch_dual_card_slots”;<br>    private static final String TAG &#x3D; “HWCardManagerPrefsFragment”;<br>    private HwCustCardManagerActivity hwCust;<br>    private HWCardManagerActivity mActivity;<br>    private CallForwardingPreference mCallForwardingEnablePreference;<br>    private Preference mCardDataDividerPerence;<br>    private CardManager mCardManager;<br>    private CardView[] mCardViews &#x3D; new CardView[]{new CardView(), new CardView()};<br>    protected Card[] mCards &#x3D; null;<br>    private Context mContext;<br>    private SwitchPreference mDataEnablePreference;<br>    private Preference mDefCallPreference;<br>    private CardSelectPreference mDefDataPreference;<br>    private CardSelectPreference mDefault4GSlotPreference;<br>    private RelativeLayout mGlobalInternetServiceDesRL;<br>    private TextView mGlobalInternetServiceDesTV;<br>    private LinearLayout mGlobalInternetServiceTitleLL;<br>    private LayoutInflater mInflater &#x3D; null;<br>    private CardNameDialogFragment mRenameFragment;<br>    private OnCheckedChangeListener onActivateViewClicked &#x3D; new OnCheckedChangeListener() {<br>        public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {<br>            if (!Utils.isAirplaneModeOn(HWCardManagerPrefsFragment.this.mContext)) {<br>                if (HWCardManagerPrefsFragment.this.checkSlotsChanging()) {<br>                    MLog.e(“HWCardManagerPrefsFragment”, “has slot is activiting…”);<br>                    return;<br>                }<br>                HWCardManagerPrefsFragment.this.hideToast();<br>                for (int i &#x3D; 0; i &lt; 2; i++) {<br>                    if (buttonView &#x3D;&#x3D; HWCardManagerPrefsFragment.this.mCardViews[i].mActivateCheckBox) {<br>                        HWCardManagerPrefsFragment.this.mActivity.tryActivatedCard(i, !HWCardManagerPrefsFragment.this.mCards[i].isActivated());<br>                    }<br>                }<br>            }<br>        }<br>    };<br>    private OnClickListener onChangeOperatorViewClicked0 &#x3D; new OnClickListener() {<br>        public void onClick(View view) {<br>            if (!Utils.isAirplaneModeOn(HWCardManagerPrefsFragment.this.mContext)) {<br>                ItemUseStat.getInstance().handleClick(HWCardManagerPrefsFragment.this.mContext, 2, “dual_card_manager_card1”);<br>                HWCardManagerPrefsFragment.this.hideToast();<br>                HWCardManagerPrefsFragment.this.showEditorNameDialog(0);<br>            }<br>        }<br>    };<br>    private OnClickListener onChangeOperatorViewClicked1 &#x3D; new OnClickListener() {<br>        public void onClick(View view) {<br>            if (!Utils.isAirplaneModeOn(HWCardManagerPrefsFragment.this.mContext)) {<br>                ItemUseStat.getInstance().handleClick(HWCardManagerPrefsFragment.this.mContext, 2, “dual_card_manager_card2”);<br>                HWCardManagerPrefsFragment.this.hideToast();<br>                HWCardManagerPrefsFragment.this.showEditorNameDialog(1);<br>            }<br>        }<br>    };<br>    private OnClickListener onChangeTextViewClicked &#x3D; new OnClickListener() {<br>        public void onClick(View view) {<br>            if (!Utils.isAirplaneModeOn(HWCardManagerPrefsFragment.this.mContext)) {<br>                HwVsimUtils.startVsimActivity(HWCardManagerPrefsFragment.this.mContext);<br>            }<br>        }<br>    };</p>
<pre><code>public HWCardManagerPrefsFragment(HWCardManagerActivity activity, HwCustCardManagerActivity cust) &#123;
    this.mActivity = activity;
    this.mContext = activity.getApplicationContext();
    this.mCardManager = activity.getCardManager();
    this.mCards = this.mCardManager.getCards();
    this.hwCust = cust;
&#125;

public void onActivityCreated(Bundle savedInstanceState) &#123;
    super.onActivityCreated(savedInstanceState);
    initHeaderView();
&#125;

public void onCreate(Bundle arg0) &#123;
    super.onCreate(arg0);
    initPreferences();
    initCustPreferences();
&#125;

public View getView() &#123;
    return super.getView();
&#125;

public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) &#123;
    super.onCreateView(inflater, container, savedInstanceState);
    return inflater.inflate(R.layout.dsdsframe_main_list, null);
&#125;

private void initHeaderView() &#123;
    if (this.mInflater == null) &#123;
        this.mInflater = LayoutInflater.from(new ContextThemeWrapper(this.mContext, this.mContext.getResources().getIdentifier(&quot;androidhwext:style/Theme.Emui&quot;, null, null)));
    &#125;
    View view = this.mInflater.inflate(R.layout.dsdsframe_header, null);
    initCardsView(view);
    initVsimPromptView(view);
    ListView list = getListView();
    if (list != null) &#123;
        list.addHeaderView(view);
        list.setOnTouchListener(new OnTouchListener() &#123;
            public boolean onTouch(View view, MotionEvent event) &#123;
                if (event.getAction() == 0) &#123;
                    HWCardManagerPrefsFragment.this.hideToast();
                &#125;
                return false;
            &#125;
        &#125;);
        list.setDivider(null);
    &#125;
&#125;

private void initVsimPromptView(View view) &#123;
    if (HwVsimUtils.isSupportVsim(this.mContext) &amp;&amp; view != null) &#123;
        HwLog.d(&quot;HWCardManagerPrefsFragment&quot;, &quot;initVsimPromptView...&quot;);
        this.mGlobalInternetServiceTitleLL = (LinearLayout) view.findViewById(R.id.globalInternetServiceTitleLL);
        this.mGlobalInternetServiceDesRL = (RelativeLayout) view.findViewById(R.id.globalInternetServiceDesRL);
        this.mGlobalInternetServiceDesRL.setOnClickListener(this.onChangeTextViewClicked);
        this.mGlobalInternetServiceDesTV = (TextView) view.findViewById(R.id.globalInternetServiceDesTV);
    &#125;
&#125;

private void initCardsView(View view) &#123;
    if (view != null) &#123;
        TextView card1_categary = (TextView) view.findViewById(R.id.card1_categary);
        TextView card1_label = (TextView) view.findViewById(R.id.card_label_1);
        String card1Text = String.format(getResources().getString(R.string.card_option_ex), new Object[]&#123;Integer.valueOf(1)&#125;);
        card1_categary.setText(card1Text);
        card1_label.setText(card1Text);
        TextView card2_categary = (TextView) view.findViewById(R.id.card2_categary);
        TextView card2_label = (TextView) view.findViewById(R.id.card_label_2);
        String card2Text = String.format(getResources().getString(R.string.card_option_ex), new Object[]&#123;Integer.valueOf(2)&#125;);
        card2_categary.setText(card2Text);
        card2_label.setText(card2Text);
        this.mCardViews = CardView.initCardViews(view);
        this.mCardViews[0].mImageViewCard.setImageResource(getCardShapRes(0));
        this.mCardViews[1].mImageViewCard.setImageResource(getCardShapRes(1));
        this.mCardViews[0].setOperatorNameOnClickListener(this.onChangeOperatorViewClicked0);
        this.mCardViews[1].setOperatorNameOnClickListener(this.onChangeOperatorViewClicked1);
    &#125;
&#125;

private boolean checkSlotsChanging() &#123;
    for (int i = 0; i &lt; 2; i++) &#123;
        if (this.mCards[i].isActivateChanging()) &#123;
            return true;
        &#125;
    &#125;
    return false;
&#125;

private void showEditorNameDialog(int subscription) &#123;
    if (this.mRenameFragment == null) &#123;
        this.mRenameFragment = new CardNameDialogFragment();
    &#125;
    this.mRenameFragment.show(getFragmentManager(), &quot;rename&quot;, subscription);
&#125;

private int getCardShapRes(int slotId) &#123;
    boolean isLargerCard = false;
    MLog.i(&quot;HWCardManagerPrefsFragment&quot;, &quot;slotId=&quot; + slotId + &quot; DualSimShapesType=&quot; + this.mActivity.getDualSimShapesType());
    switch (this.mActivity.getDualSimShapesType()) &#123;
        case 1:
            if (slotId != 0) &#123;
                isLargerCard = false;
                break;
            &#125;
            isLargerCard = true;
            break;
        case 2:
            if (slotId != 1) &#123;
                isLargerCard = false;
                break;
            &#125;
            isLargerCard = true;
            break;
    &#125;
    if (isLargerCard) &#123;
        if (this.mCards[slotId].isInserted()) &#123;
            return R.drawable.micro_sim_card_normal;
        &#125;
        return R.drawable.micro_sim_card_off;
    &#125; else if (this.mCards[slotId].isInserted()) &#123;
        return R.drawable.nano_sim_card_normal;
    &#125; else &#123;
        return R.drawable.nano_sim_card_off;
    &#125;
&#125;

private void addPreferencesResource() &#123;
    if (this.hwCust == null || !Constants.IS_CF_OPTION_ON) &#123;
        addPreferencesFromResource(R.xml.dsds_ug);
    &#125; else &#123;
        this.hwCust.addCustPreferencesFromResource();
    &#125;
&#125;

private void initPreferences() &#123;
    addPreferencesResource();
    PreferenceScreen screen = getPreferenceScreen();
    this.mDataEnablePreference = (SwitchPreference) screen.findPreference(&quot;data_enabled&quot;);
    this.mDataEnablePreference.setOnPreferenceChangeListener(this);
    screen.removePreference(this.mDataEnablePreference);
    this.mDefault4GSlotPreference = (CardSelectPreference) screen.findPreference(&quot;switch_dual_card_slots&quot;);
    if (Constants.IS_4G_DATA_BIND) &#123;
        this.mDefault4GSlotPreference.setTitle(R.string.default_data_network_emui);
    &#125; else &#123;
        this.mDefault4GSlotPreference.setTitle(Utils.check3GString(R.string.switch_dual_card_slots_emui));
    &#125;
    this.mCardDataDividerPerence = screen.findPreference(&quot;card_and_data_divider&quot;);
    this.mDefault4GSlotPreference.setOnPreferenceChangeListener(this);
    if (!CardManager.isSupportedSetDefault4GSlotId()) &#123;
        screen.removePreference(this.mDefault4GSlotPreference);
        if (this.mCardDataDividerPerence != null) &#123;
            screen.removePreference(this.mCardDataDividerPerence);
        &#125;
    &#125;
    this.mDefDataPreference = (CardSelectPreference) screen.findPreference(&quot;default_data_network&quot;);
    this.mDefDataPreference.setOnPreferenceChangeListener(this);
    this.mDefCallPreference = screen.findPreference(&quot;default_card_mode&quot;);
    this.mDefCallPreference.setOnPreferenceClickListener(this);
    this.mCallForwardingEnablePreference = (CallForwardingPreference) screen.findPreference(&quot;call_forwarding_enable&quot;);
    if (this.mCallForwardingEnablePreference != null) &#123;
        this.mCallForwardingEnablePreference.setOnPreferenceClickListener(this);
    &#125;
    if (Constants.IS_4G_DATA_BIND) &#123;
        screen.removePreference(this.mDefDataPreference);
        if (this.mCardDataDividerPerence != null) &#123;
            screen.removePreference(this.mCardDataDividerPerence);
            return;
        &#125;
        return;
    &#125;
    PreferenceCategoryug preferenceCategory = (PreferenceCategoryug) screen.findPreference(&quot;dsds_preference_category&quot;);
    if (preferenceCategory != null) &#123;
        Preference enableDivider = screen.findPreference(&quot;call_forwarding_enable_divider&quot;);
        if (enableDivider != null) &#123;
            preferenceCategory.removePreference(enableDivider);
        &#125;
        if (this.mCallForwardingEnablePreference != null) &#123;
            preferenceCategory.removePreference(this.mCallForwardingEnablePreference);
        &#125;
    &#125;
&#125;

private void initCustPreferences() &#123;
    if (this.hwCust != null) &#123;
        this.hwCust.initCustPreferences();
    &#125;
&#125;

public void onStart() &#123;
    super.onStart();
&#125;

public void onStop() &#123;
    super.onStop();
&#125;

public void onAttach(Activity activity) &#123;
    super.onAttach(activity);
&#125;

public void onDestroy() &#123;
    super.onDestroy();
&#125;

public void onPause() &#123;
    super.onPause();
&#125;

public void onResume() &#123;
    super.onResume();
&#125;

public void onTrimMemory(int level) &#123;
    super.onTrimMemory(level);
&#125;

public void updateView() &#123;
    if (isAdded() &amp;&amp; getActivity() != null) &#123;
        updateCardsView();
        updatePreferences();
    &#125;
&#125;

private void updateCardsView() &#123;
    if (this.mCardViews[0].mIsInitView) &#123;
        boolean isSlot2Disabled = isSlot2Disabled();
        int i = 0;
        while (i &lt; 2) &#123;
            boolean activated;
            boolean activateSwitchChecked;
            boolean z;
            this.mCardViews[i].mImageViewCard.setImageResource(getCardShapRes(i));
            boolean inserted = this.mCards[i].isInserted();
            if (!this.mCards[i].isActivated() || this.mCards[i].isPinLocked()) &#123;
                activated = false;
            &#125; else &#123;
                activated = !this.mCards[i].isPukLocked();
            &#125;
            if (activated) &#123;
                activateSwitchChecked = inserted;
            &#125; else &#123;
                activateSwitchChecked = false;
            &#125;
            setActivateSwitchChecked(i, activateSwitchChecked);
            CardView cardView = this.mCardViews[i];
            if (!inserted || Utils.isAirplaneModeOn(this.mContext)) &#123;
                z = false;
            &#125; else &#123;
                z = true;
            &#125;
            cardView.setEnabled(z);
            if (1 == i &amp;&amp; isSlot2Disabled) &#123;
                setActivateSwitchChecked(i, false);
                this.mCardViews[i].setEnabled(false);
            &#125;
            if (inserted) &#123;
                this.mCardViews[i].setOperaterNameChangeEnabled(activated);
                if (activated) &#123;
                    String iSimCardName = this.mActivity.getDataAccessor().getSimCardName(i);
                    HwLog.d(&quot;HWCardManagerPrefsFragment&quot;, &quot;iSimCardName&quot; + i + &quot;=&quot; + iSimCardName);
                    if (TextUtils.isEmpty(iSimCardName)) &#123;
                        iSimCardName = this.mCards[i].getOperatorName();
                        HwLog.d(&quot;HWCardManagerPrefsFragment&quot;, &quot;mOperatorName&quot; + i + &quot;=&quot; + iSimCardName);
                    &#125; else &#123;
                        this.mCardViews[i].setTitle(iSimCardName);
                    &#125;
                    this.mCardViews[i].setTitle(iSimCardName);
                &#125; else &#123;
                    this.mCardViews[i].setTitle((int) R.string.inactive);
                &#125;
                String phoneNumber = CardManager.getPhoneNumber(i);
                if (TextUtils.isEmpty(phoneNumber)) &#123;
                    this.mCardViews[i].setSummary(&quot;&quot;);
                &#125; else &#123;
                    this.mCardViews[i].setSummary(phoneNumber);
                &#125;
                if (this.mCards[i].isPinLocked()) &#123;
                    this.mCardViews[i].setSummary((int) R.string.pinlocked);
                &#125; else if (this.mCards[i].isPukLocked()) &#123;
                    this.mCardViews[i].setSummary((int) R.string.puklocked);
                &#125;
            &#125; else &#123;
                this.mCardViews[i].setTitle((int) R.string.nocard);
                this.mCardViews[i].setSummary(&quot;&quot;);
                dismissDialogFragment();
            &#125;
            this.mCardViews[i].hideSummaryIfEmpty();
            i++;
        &#125;
        String card1Type = this.mContext.getString(Utils.check3GString(R.string.cardstatus1));
        if (this.hwCust != null) &#123;
            card1Type = this.hwCust.updateTitleToLTE(card1Type);
        &#125;
        String card2Type = getCustCardType(this.mContext.getString(R.string.cardstatus2));
        if (CardManager.getDefault4GSlotId() == 0) &#123;
            this.mCardViews[0].mTypeStatusTextView.setText(card1Type);
            this.mCardViews[1].mTypeStatusTextView.setText(card2Type);
        &#125; else if (1 == CardManager.getDefault4GSlotId()) &#123;
            this.mCardViews[0].mTypeStatusTextView.setText(card2Type);
            this.mCardViews[1].mTypeStatusTextView.setText(card1Type);
        &#125;
        updateVsimPromptView();
    &#125;
&#125;

private void setActivateSwitchChecked(int index, boolean checked) &#123;
    if (!this.mCards[index].isActivateChanging()) &#123;
        this.mCardViews[index].mActivateCheckBox.setOnCheckedChangeListener(null);
        this.mCardViews[index].mActivateCheckBox.setChecked(checked);
        this.mCardViews[index].mActivateCheckBox.setOnCheckedChangeListener(this.onActivateViewClicked);
    &#125;
&#125;

private void updateVsimPromptView() &#123;
    if (HwVsimUtils.isSupportVsim(this.mContext)) &#123;
        if (HwVsimUtils.isVsimOpen()) &#123;
            boolean isInserted = this.mCards[0].isInserted() ? this.mCards[1].isInserted() : false;
            int vsimSlotId = HwVsimUtils.getVsimSlotId();
            HwLog.d(&quot;HWCardManagerPrefsFragment&quot;, &quot;updateVsimPromptView isDualCardInserted=&quot; + isInserted + &quot;, vsimSlotId=&quot; + vsimSlotId);
            if (isInserted &amp;&amp; Constants.isValidSlotId(vsimSlotId)) &#123;
                this.mCardViews[vsimSlotId].setEnabled(false);
                this.mCardViews[vsimSlotId].mImageViewCard.setImageResource(R.drawable.nano_sim_card_off);
            &#125;
            if (HwVsimUtils.isSupportThreeModem() &amp;&amp; isInserted &amp;&amp; vsimSlotId == 2) &#123;
                String card1Type = getResources().getString(R.string.cardstatus2);
                String card2Type = getCustCardType(getResources().getString(R.string.cardstatus2));
                if (CardManager.getDefault4GSlotId() == 0) &#123;
                    this.mCardViews[0].mTypeStatusTextView.setText(card1Type);
                    this.mCardViews[1].mTypeStatusTextView.setText(card2Type);
                &#125; else if (1 == CardManager.getDefault4GSlotId()) &#123;
                    this.mCardViews[0].mTypeStatusTextView.setText(card2Type);
                    this.mCardViews[1].mTypeStatusTextView.setText(card1Type);
                &#125;
            &#125;
            this.mGlobalInternetServiceDesTV.setText(HwVsimUtils.getVsimSummary(this.mContext, this.mCards));
            this.mGlobalInternetServiceDesRL.setVisibility(0);
            this.mGlobalInternetServiceTitleLL.setVisibility(0);
        &#125; else if (!(this.mGlobalInternetServiceDesRL == null || this.mGlobalInternetServiceTitleLL == null)) &#123;
            this.mGlobalInternetServiceDesRL.setVisibility(8);
            this.mGlobalInternetServiceTitleLL.setVisibility(8);
        &#125;
    &#125;
&#125;

private String getCustCardType(String cardType) &#123;
    boolean notInserted = (this.mCards[0].isInserted() || this.mCards[1].isInserted()) ? false : true;
    if (TelephonyManagerEx.checkCdmaSlaveCardMode(0) || Constants.IS_VICE_WCDMA) &#123;
        cardType = this.mContext.getString(R.string.cardtype);
    &#125;
    if (NOT_INSERT_CARD_BOTH_2G_3G_4G &amp;&amp; notInserted) &#123;
        return this.mContext.getString(R.string.cardstatus1);
    &#125;
    return cardType;
&#125;

public boolean onPreferenceChange(Preference preference, Object newValue) &#123;
    String key = preference.getKey();
    String value = String.valueOf(newValue);
    MLog.d(&quot;HWCardManagerPrefsFragment&quot;, &quot;onPreferenceChange key = &quot; + key + &quot; value=&quot; + value);
    int slotId;
    if (&quot;default_data_network&quot;.equals(key)) &#123;
        ItemUseStat.getInstance().handleClick(this.mContext, 2, key, value);
        slotId = CardSelectPreference.getSlotIdValueBy(value);
        this.mActivity.clearSwitchDataAfterSet4G();
        if (this.hwCust == null || !IS_FULL_NETWORK_SUPPORTED) &#123;
            this.mActivity.startChangeDefaultDataCard(slotId);
        &#125; else &#123;
            this.hwCust.switchDefaultDataforAllNetwork(slotId);
        &#125;
    &#125; else if (&quot;switch_dual_card_slots&quot;.equals(key)) &#123;
        slotId = CardSelectPreference.getSlotIdValueBy(value);
        if (this.hwCust == null || !IS_FULL_NETWORK_SUPPORTED) &#123;
            ItemUseStat.getInstance().handleClick(this.mContext, 2, &quot;switch_sim_card_slots&quot;, slotId);
            this.mActivity.trySetDefault4GSlotId(slotId);
        &#125; else &#123;
            this.hwCust.switchDefault4GforAllNetwork(slotId);
        &#125;
    &#125; else if (&quot;data_enabled&quot;.equals(key)) &#123;
        this.mCardManager.setDataEnabled(Boolean.parseBoolean(value));
    &#125;
    return true;
&#125;

public boolean onPreferenceClick(Preference preference) &#123;
    TipToastManager.getInstance().hide();
    if (preference == this.mDataEnablePreference) &#123;
        boolean isSelected = this.mDataEnablePreference.isChecked();
        this.mCardManager.setDataEnabled(isSelected);
        this.mDataEnablePreference.setChecked(isSelected);
    &#125; else if (preference == this.mDefCallPreference) &#123;
        callCardSettings();
        ItemUseStat.getInstance().handleClick(this.mContext, 2, &quot;default_card_mode&quot;);
    &#125; else if (preference == this.mCallForwardingEnablePreference) &#123;
        this.mActivity.startActivity(new Intent(this.mActivity, CallForwardingManagerActivity.class));
    &#125;
    return true;
&#125;

private void updatePreferences() &#123;
    boolean z = true;
    if (this.mDefault4GSlotPreference != null) &#123;
        boolean canChangePefCard = this.mCardManager.canChangePefCard() ? !Utils.isAirplaneModeOn(this.mContext) : false;
        CardSelectPreference cardSelectPreference;
        boolean z2;
        if (Constants.IS_4G_DATA_BIND) &#123;
            cardSelectPreference = this.mDefault4GSlotPreference;
            if (Utils.isAirplaneModeOn(this.mContext)) &#123;
                z2 = false;
            &#125; else &#123;
                z2 = CardManager.isSetDefault4GSlotIdEnabled();
            &#125;
            cardSelectPreference.setEnabled(z2);
            if (HwVsimUtils.isVsimOpen(this.mContext)) &#123;
                HwLog.d(&quot;HWCardManagerPrefsFragment&quot;, &quot;updatePreferences Vsim opened, disabale 4GSlotPreference&quot;);
                this.mDefault4GSlotPreference.setEnabled(false);
            &#125;
            this.mDefCallPreference.setEnabled(canChangePefCard);
            this.mDefCallPreference.setSummary(getDefCallSettingsStrId());
            if (this.mActivity.isUpdateDef4GSlotView) &#123;
                this.mDefault4GSlotPreference.setValue(CardSelectPreference.getValueBySlotId(CardManager.getDefault4GSlotId()));
                this.mDefault4GSlotPreference.updateNetherSummaryTextView();
            &#125; else &#123;
                return;
            &#125;
        &#125;
        cardSelectPreference = this.mDefDataPreference;
        z2 = canChangePefCard &amp;&amp; !CardManager.phoneIsOffhook(this.mContext);
        cardSelectPreference.setEnabled(z2);
        this.mDefCallPreference.setEnabled(canChangePefCard);
        cardSelectPreference = this.mDefault4GSlotPreference;
        if (Utils.isAirplaneModeOn(this.mContext)) &#123;
            z2 = false;
        &#125; else &#123;
            z2 = CardManager.isSetDefault4GSlotIdEnabled();
        &#125;
        cardSelectPreference.setEnabled(z2);
        if (!this.mActivity.isDataDailogWaiting().booleanValue()) &#123;
            updateDefDataPrefercenceValue();
            updateDefault4GSlotPreference();
        &#125;
        this.mDefCallPreference.setSummary(getDefCallSettingsStrId());
        if (this.hwCust != null) &#123;
            this.hwCust.updateCustPreferences(this.mDefault4GSlotPreference);
        &#125;
        if (HwVsimUtils.isSupportVsim(this.mContext) &amp;&amp; HwVsimUtils.isVsimOpen()) &#123;
            HwLog.d(&quot;HWCardManagerPrefsFragment&quot;, &quot;updatePreferences Vsim opened, disabale 4GSlotPreference and DataPreference&quot;);
            this.mDefault4GSlotPreference.setEnabled(false);
            this.mDefDataPreference.setEnabled(false);
        &#125;
        if (!(Constants.IS_4G_DATA_BIND || this.hwCust == null)) &#123;
            this.hwCust.updatePreferenceTitleToLTE(this.mDefault4GSlotPreference);
        &#125;
        boolean phoneIsOffhook = CardManager.phoneIsOffhook(this.mContext);
        if (!canChangePefCard || phoneIsOffhook) &#123;
            z = false;
        &#125;
        updateCallForwardingPreference(z);
        if (phoneIsOffhook) &#123;
            this.mDefault4GSlotPreference.setEnabled(false);
        &#125;
        boolean isSlot2Disable = isSlot2Disabled();
        if (isSlot2DataConnectivityDisabled() || isSlot2Disable) &#123;
            if (this.mDefDataPreference != null) &#123;
                this.mDefDataPreference.setEnabled(false);
            &#125;
            this.mDefault4GSlotPreference.setEnabled(false);
        &#125;
    &#125;
&#125;

public void updatePhoneStatePreferences(boolean enable) &#123;
    if (isAdded() &amp;&amp; getActivity() != null) &#123;
        if (this.mDefault4GSlotPreference != null) &#123;
            this.mDefault4GSlotPreference.setEnabled(enable);
        &#125;
        if (this.mCallForwardingEnablePreference != null) &#123;
            this.mCallForwardingEnablePreference.setEnabled(enable);
        &#125;
    &#125;
&#125;

public String getDefCallSettingsStrId() &#123;
    return getCallCardSettingsString(this.mContext, Global.getInt(this.mContext.getContentResolver(), &quot;default_simcard_slotid&quot;, -1));
&#125;

private void updateDefDataPrefercenceValue() &#123;
    this.mDefDataPreference.setValue(CardSelectPreference.getValueBySlotId(this.mCardManager.getRealCardForMobileData()));
&#125;

private void updateDefault4GSlotPreference() &#123;
    this.mDefault4GSlotPreference.setValue(CardSelectPreference.getValueBySlotId(CardManager.getDefault4GSlotId()));
&#125;

private void hideToast() &#123;
    if (TipToastManager.getInstance().isShowing()) &#123;
        TipToastManager.getInstance().hide();
    &#125;
&#125;

private void updateCallForwardingPreference(boolean enable) &#123;
    boolean z = false;
    if (this.mCallForwardingEnablePreference != null) &#123;
        CallForwardingPreference callForwardingPreference = this.mCallForwardingEnablePreference;
        if (enable &amp;&amp; !hasCdmaCard()) &#123;
            z = true;
        &#125;
        callForwardingPreference.setEnabled(z);
        this.mCallForwardingEnablePreference.setNetherSummary((int) R.string.call_forward_summary);
        this.mCallForwardingEnablePreference.setSummary(CallForwardingManager.getCallForwardingModeValue(this.mContext, this.mCardManager));
    &#125;
&#125;

private boolean hasCdmaCard() &#123;
    return !CardManager.isCdmaCard(0) ? CardManager.isCdmaCard(1) : true;
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">切换数据连接应该是</span><br></pre></td></tr></table></figure>
<pre><code>    this.mDataEnablePreference.setOnPreferenceChangeListener(this);
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">触发的代码</span><br></pre></td></tr></table></figure>
<p>   if (preference &#x3D;&#x3D; this.mDataEnablePreference) {<br>            boolean isSelected &#x3D; this.mDataEnablePreference.isChecked();<br>            this.mCardManager.setDataEnabled(isSelected);<br>            this.mDataEnablePreference.setChecked(isSelected);<br>        } </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">关闭数据连接的代码就得到了</span><br></pre></td></tr></table></figure>

<pre><code>public void setDataEnabled(boolean enabled) &#123;
    try &#123;
        ((TelephonyManager) this.mContext.getSystemService(&quot;phone&quot;)).setDataEnabled(enabled);
    &#125; catch (NullPointerException e) &#123;
        MLog.e(&quot;CardManager&quot;, &quot;Phone module did not start!&quot;);
    &#125;
&#125;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">但是这里似乎不对劲呀，我要的是切换的。</span><br><span class="line">观看别人源码能学到很多东西啊，cardmanager的源码如下</span><br></pre></td></tr></table></figure>
<p>package com.huawei.android.dsdscardmanager.model;</p>
<p>import android.content.Context;<br>import android.content.Intent;<br>import android.os.Message;<br>import android.os.SystemProperties;<br>import android.provider.Settings.Global;<br>import android.provider.Settings.SettingNotFoundException;<br>import android.telephony.HwTelephonyManager;<br>import android.telephony.MSimTelephonyManager;<br>import android.telephony.PhoneNumberUtils;<br>import android.telephony.SubscriptionManager;<br>import android.telephony.TelephonyManager;<br>import android.text.TextUtils;<br>import com.android.internal.telephony.HwSubscriptionManager;<br>import com.android.internal.telephony.OperatorInfo;<br>import com.android.internal.telephony.Phone;<br>import com.android.internal.telephony.PhoneFactory;<br>import com.huawei.android.dsdscardmanager.Constants;<br>import com.huawei.android.dsdscardmanager.ItemUseStat;<br>import com.huawei.android.dsdscardmanager.MLog;<br>import com.huawei.telephony.HuaweiTelephonyManager;<br>import java.lang.reflect.InvocationTargetException;</p>
<p>public class CardManager {<br>    public static final boolean BPROPERTY_MAX_SUPPORT_4G &#x3D; isSupportedSet4G();<br>    public static final int NETWORK_CLASS_3G &#x3D; 2;<br>    public static final int STATE_ACTIVATED &#x3D; 1;<br>    public static final int STATE_DEACTIVATED &#x3D; 0;<br>    private static final String TAG &#x3D; “CardManager”;<br>    private static final String USER_DATACALL_SUBSCRIPTION &#x3D; “user_datacall_sub”;<br>    private static final String USER_DEFAULT_SUBSCRIPTION &#x3D; “user_default_sub”;<br>    private Card[] cards &#x3D; new Card[]{new Card(0), new Card(1)};<br>    private int mCardCount &#x3D; 0;<br>    private Context mContext;</p>
<pre><code>public CardManager(Context context) &#123;
    this.mContext = context;
&#125;

public static Phone getPhone(int slotId) &#123;
    Phone phone = null;
    try &#123;
        phone = PhoneFactory.getPhone(slotId);
    &#125; catch (Exception e) &#123;
        MLog.e(&quot;CardManager&quot;, &quot;error!getphone exception!&quot;);
        e.printStackTrace();
    &#125;
    return phone;
&#125;

public static boolean isMultiSimEnabled() &#123;
    try &#123;
        return MSimTelephonyManager.getDefault().isMultiSimEnabled();
    &#125; catch (Exception e) &#123;
        e.printStackTrace();
        return false;
    &#125;
&#125;

public static boolean isChinaTelecom() &#123;
    if (SystemProperties.get(&quot;ro.config.hw_opta&quot;, &quot;&quot;).equals(&quot;92&quot;)) &#123;
        return SystemProperties.get(&quot;ro.config.hw_optb&quot;, &quot;&quot;).equals(&quot;156&quot;);
    &#125;
    return false;
&#125;

public static int getSimState(int slotId) &#123;
    return MSimTelephonyManager.getDefault().getSimState(slotId);
&#125;

public static int getSlotId(long subId) &#123;
    int slotId = SubscriptionManager.getSlotId((int) subId);
    if (Constants.isValidSlotId(slotId)) &#123;
        return slotId;
    &#125;
    MLog.e(&quot;CardManager&quot;, &quot;getSlotId is invalid, we use the defualt slotid.slotId=&quot; + slotId);
    return 0;
&#125;

public static long getSubId(int slotId) &#123;
    if (SubscriptionManager.getSubId(slotId) == null || SubscriptionManager.getSubId(slotId).length &lt;= 0) &#123;
        MLog.e(&quot;CardManager&quot;, &quot;getSubId return null, we use the defualt subId 0&quot;);
        return 0;
    &#125;
    MLog.i(&quot;CardManager&quot;, &quot;getSubId(&quot; + slotId + &quot;) = &quot; + SubscriptionManager.getSubId(slotId)[0]);
    return (long) SubscriptionManager.getSubId(slotId)[0];
&#125;

public static boolean activateCard(int slotId, boolean activate, Message onCompleteMsg) &#123;
    try &#123;
        MLog.i(&quot;CardManager&quot;, &quot;setSubscription card:slotId=&quot; + slotId + &quot; activate=&quot; + activate);
        boolean rs = HwSubscriptionManager.getInstance().setSubscription(slotId, activate, onCompleteMsg);
        MLog.i(&quot;CardManager&quot;, &quot;setSubscription res:&quot; + rs);
        return rs;
    &#125; catch (Exception e) &#123;
        MLog.w(&quot;CardManager&quot;, &quot;setSubscription card failed&quot;);
        e.printStackTrace();
        return false;
    &#125;
&#125;

public static boolean isCardActivate(int slotId) &#123;
    return getCardActivateState(slotId) == 1;
&#125;

public static int getCardActivateState(int slotId) &#123;
    int state = 0;
    try &#123;
        MLog.i(&quot;CardManager&quot;, &quot;isCardActivate slotId=&quot; + slotId + &quot; subId:&quot; + getSubId(slotId));
        state = HwTelephonyManager.getDefault().getSubState(getSubId(slotId));
    &#125; catch (Exception e) &#123;
        MLog.w(&quot;CardManager&quot;, &quot;get card activated state failed!&quot;);
        e.printStackTrace();
    &#125;
    MLog.i(&quot;CardManager&quot;, &quot;isCardActivate slotId=&quot; + slotId + &quot; result=&quot; + state);
    return state;
&#125;

public static boolean isTelecomiot() &#123;
    return SystemProperties.getBoolean(&quot;ro.config.dsds_telecomiot&quot;, false);
&#125;

public static boolean isSupportedSetDefault4GSlotId() &#123;
    return SystemProperties.getBoolean(&quot;persist.sys.dualcards&quot;, false);
&#125;

public static boolean isSupportedSet4G() &#123;
    return SystemProperties.getBoolean(&quot;ro.config.hw_lte_support&quot;, true);
&#125;

public static boolean isSetDefault4GSlotIdEnabled() &#123;
    try &#123;
        boolean enabled = reflectIsSetDefault4GSlotIdEnabled();
        MLog.i(&quot;CardManager&quot;, &quot;isSetDefault4GSlotIdEnabled enabled=&quot; + enabled);
        return enabled;
    &#125; catch (Exception e) &#123;
        MLog.w(&quot;CardManager&quot;, &quot;isSetDefault4GSlotIdEnabled card failed&quot;);
        e.printStackTrace();
        return false;
    &#125;
&#125;

private static boolean reflectIsSetDefault4GSlotIdEnabled() &#123;
    try &#123;
        return Boolean.parseBoolean(HuaweiTelephonyManager.class.getMethod(&quot;isSetDefault4GSlotIdEnabled&quot;, new Class[0]).invoke(HuaweiTelephonyManager.getDefault(), new Object[0]).toString());
    &#125; catch (NoSuchMethodException e) &#123;
        e.printStackTrace();
        MLog.e(&quot;CardManager&quot;, &quot;error!method isSetDefault4GSlotIdEnabled is not suppported!&quot;);
        return false;
    &#125; catch (IllegalAccessException e2) &#123;
        e2.printStackTrace();
        MLog.e(&quot;CardManager&quot;, &quot;error!method isSetDefault4GSlotIdEnabled is not suppported!&quot;);
        return false;
    &#125; catch (IllegalArgumentException e3) &#123;
        e3.printStackTrace();
        MLog.e(&quot;CardManager&quot;, &quot;error!method isSetDefault4GSlotIdEnabled is not suppported!&quot;);
        return false;
    &#125; catch (InvocationTargetException e4) &#123;
        e4.printStackTrace();
        MLog.e(&quot;CardManager&quot;, &quot;error!method isSetDefault4GSlotIdEnabled is not suppported!&quot;);
        return false;
    &#125;
&#125;

public static void setDefault4GSlotId(int slotId, Message msg) &#123;
    try &#123;
        MLog.i(&quot;CardManager&quot;, &quot;setDefault4GSlotId card:slotId=&quot; + slotId);
        reflectSetDefault4GSlotId(slotId, msg);
    &#125; catch (Exception e) &#123;
        MLog.w(&quot;CardManager&quot;, &quot;setDefault4GCard card failed&quot;);
        e.printStackTrace();
    &#125;
&#125;

private static void reflectSetDefault4GSlotId(int slotId, Message msg) &#123;
    try &#123;
        HuaweiTelephonyManager.class.getMethod(&quot;setDefault4GSlotId&quot;, new Class[]&#123;Integer.TYPE, Message.class&#125;).invoke(HuaweiTelephonyManager.getDefault(), new Object[]&#123;Integer.valueOf(slotId), msg&#125;);
    &#125; catch (NoSuchMethodException e) &#123;
        e.printStackTrace();
        MLog.e(&quot;CardManager&quot;, &quot;error! method setDefault4GSlotId is not suppported!&quot;);
    &#125; catch (IllegalAccessException e2) &#123;
        e2.printStackTrace();
        MLog.e(&quot;CardManager&quot;, &quot;error! method setDefault4GSlotId is not suppported!&quot;);
    &#125; catch (IllegalArgumentException e3) &#123;
        e3.printStackTrace();
        MLog.e(&quot;CardManager&quot;, &quot;error! method setDefault4GSlotId is not suppported!&quot;);
    &#125; catch (InvocationTargetException e4) &#123;
        e4.printStackTrace();
        MLog.e(&quot;CardManager&quot;, &quot;error! method setDefault4GSlotId is not suppported!&quot;);
    &#125;
&#125;

public static boolean isCdmaCard(int slotId) &#123;
    Phone phone = getPhone(slotId);
    if (phone != null) &#123;
        return 2 == phone.getPhoneType();
    &#125; else &#123;
        return false;
    &#125;
&#125;

public static int getDefault4GSlotId() &#123;
    try &#123;
        MLog.i(&quot;CardManager&quot;, &quot;getDefault4GSlotId&quot;);
        int slotId = reflectGetDefault4GSlotId();
        MLog.i(&quot;CardManager&quot;, &quot;getDefault4GSlotId rs=&quot; + slotId);
        if (Constants.isValidSlotId(slotId)) &#123;
            return slotId;
        &#125;
    &#125; catch (Exception e) &#123;
        MLog.w(&quot;CardManager&quot;, &quot;getDefault4GSlotId card failed&quot;);
        e.printStackTrace();
    &#125;
    return 0;
&#125;

private static int reflectGetDefault4GSlotId() &#123;
    try &#123;
        return Integer.parseInt(HuaweiTelephonyManager.class.getMethod(&quot;getDefault4GSlotId&quot;, new Class[0]).invoke(HuaweiTelephonyManager.getDefault(), new Object[0]).toString());
    &#125; catch (NumberFormatException e) &#123;
        e.printStackTrace();
        MLog.e(&quot;CardManager&quot;, &quot;error!method getDefault4GSlotId is not suppported!&quot;);
        return 0;
    &#125; catch (NoSuchMethodException e2) &#123;
        e2.printStackTrace();
        MLog.e(&quot;CardManager&quot;, &quot;error!method getDefault4GSlotId is not suppported!&quot;);
        return 0;
    &#125; catch (IllegalAccessException e3) &#123;
        e3.printStackTrace();
        MLog.e(&quot;CardManager&quot;, &quot;error!method getDefault4GSlotId is not suppported!&quot;);
        return 0;
    &#125; catch (IllegalArgumentException e4) &#123;
        e4.printStackTrace();
        MLog.e(&quot;CardManager&quot;, &quot;error!method getDefault4GSlotId is not suppported!&quot;);
        return 0;
    &#125; catch (InvocationTargetException e5) &#123;
        e5.printStackTrace();
        MLog.e(&quot;CardManager&quot;, &quot;error!method getDefault4GSlotId is not suppported!&quot;);
        return 0;
    &#125;
&#125;

public static void setPrefCardForMobileData(int slotId) &#123;
    try &#123;
        MLog.i(&quot;CardManager&quot;, &quot;card setPrefCardForMobileData:&quot; + slotId);
        HwSubscriptionManager.getInstance().setUserPrefDataSlotId(slotId);
    &#125; catch (Exception e) &#123;
        MLog.w(&quot;CardManager&quot;, &quot;set default card for mobile data failed!&quot;);
        e.printStackTrace();
    &#125;
&#125;

public int getPreCardForMobileData() &#123;
    try &#123;
        int slotId = Global.getInt(this.mContext.getContentResolver(), &quot;user_datacall_sub&quot;, 0);
        MLog.i(&quot;CardManager&quot;, &quot;getPreCardForMobileData:&quot; + slotId);
        if (Constants.isValidSlotId(slotId)) &#123;
            return slotId;
        &#125;
        return 0;
    &#125; catch (Exception e) &#123;
        MLog.w(&quot;CardManager&quot;, &quot;get default card for mobile data failed!&quot;);
        e.printStackTrace();
    &#125;
&#125;

public int getRealCardForMobileData() &#123;
    int slotId = readSlotId(&quot;multi_sim_data_call&quot;);
    MLog.i(&quot;CardManager&quot;, &quot;real def data:&quot; + slotId);
    if (Constants.isValidSlotId(slotId)) &#123;
        return slotId;
    &#125;
    return 0;
&#125;

public static void setPrefCardForCallSms(int slotId) &#123;
    try &#123;
        MLog.i(&quot;CardManager&quot;, &quot;card setPrefCardForCallSms:&quot; + slotId);
        HwSubscriptionManager.getInstance().setUserPrefDefaultSlotId(slotId);
    &#125; catch (Exception e) &#123;
        MLog.w(&quot;CardManager&quot;, &quot;set default card for call and sms failed!&quot;);
        e.printStackTrace();
    &#125;
&#125;

public int getPrefCardForCallSms() &#123;
    try &#123;
        int slotId = Global.getInt(this.mContext.getContentResolver(), &quot;user_default_sub&quot;, 0);
        MLog.i(&quot;CardManager&quot;, &quot;getPreCardForMobileData:&quot; + slotId);
        if (Constants.isValidSlotId(slotId)) &#123;
            return slotId;
        &#125;
        return 0;
    &#125; catch (Exception e) &#123;
        MLog.w(&quot;CardManager&quot;, &quot;get default card for mobile data failed!&quot;);
        e.printStackTrace();
    &#125;
&#125;

public int getRealCardForCallSms() &#123;
    int slotId = readSlotId(&quot;multi_sim_sms&quot;);
    MLog.i(&quot;CardManager&quot;, &quot;real def SMS:&quot; + slotId);
    if (Constants.isValidSlotId(slotId)) &#123;
        return slotId;
    &#125;
    slotId = readSlotId(&quot;multi_sim_voice_call&quot;);
    MLog.i(&quot;CardManager&quot;, &quot;real def voice:&quot; + slotId);
    if (Constants.isValidSlotId(slotId)) &#123;
        return slotId;
    &#125;
    return 0;
&#125;

private int readSlotId(String name) &#123;
    long subId;
    try &#123;
        subId = (long) Global.getInt(this.mContext.getContentResolver(), name);
    &#125; catch (SettingNotFoundException e) &#123;
        MLog.e(&quot;CardManager&quot;, &quot;Settings Exception reading values of &quot; + name);
        subId = 0;
    &#125;
    return getSlotId(subId);
&#125;

public static String getPhoneNumber(int slotId) &#123;
    Phone phone = null;
    try &#123;
        phone = PhoneFactory.getPhone(slotId);
    &#125; catch (Exception ex) &#123;
        MLog.w(&quot;CardManager&quot;, &quot;get Phone exception for sub:&quot; + slotId);
        ex.printStackTrace();
    &#125;
    if (phone != null) &#123;
        String rawNumber = phone.getLine1Number();
        if (!TextUtils.isEmpty(rawNumber)) &#123;
            return PhoneNumberUtils.formatNumber(rawNumber);
        &#125;
    &#125;
    MLog.w(&quot;CardManager&quot;, &quot;phone number is empty&quot;);
    return null;
&#125;

public static String getPhoneNumber(Phone phone) &#123;
    if (phone != null) &#123;
        return phone.getLine1Number();
    &#125;
    MLog.w(&quot;CardManager&quot;, &quot;phone number is empty&quot;);
    return null;
&#125;

public boolean canChangePefCard() &#123;
    int i = 0;
    while (i &lt; 2) &#123;
        if (!this.cards[i].isActivated() || getSimState(i) != 5) &#123;
            return false;
        &#125;
        i++;
    &#125;
    return true;
&#125;

public void resumeCardsStates() &#123;
    int mCount = 0;
    for (int i = 0; i &lt; 2; i++) &#123;
        boolean z;
        int state = getSimState(i);
        Card card = this.cards[i];
        if (state == 1) &#123;
            z = true;
        &#125; else &#123;
            z = false;
        &#125;
        card.setAbsent(z);
        MLog.i(&quot;CardManager&quot;, &quot;slotId=&quot; + i + &quot; simstate=&quot; + state);
        this.cards[i].setInserted(false);
        this.cards[i].setCardIOError(false);
        this.cards[i].setPinLocked(false);
        this.cards[i].setPukLocked(false);
        this.cards[i].setReady(false);
        switch (state) &#123;
            case 0:
            case 6:
                this.cards[i].setInserted(true);
                break;
            case 2:
            case 4:
                this.cards[i].setInserted(true);
                this.cards[i].setPinLocked(true);
                break;
            case 3:
                this.cards[i].setInserted(true);
                this.cards[i].setPukLocked(true);
                break;
            case 5:
                this.cards[i].setInserted(true);
                this.cards[i].setReady(true);
                break;
        &#125;
        if (8 == state) &#123;
            this.cards[i].setInserted(true);
            this.cards[i].setCardIOError(true);
        &#125;
        if (this.cards[i].isInserted()) &#123;
            mCount++;
        &#125;
    &#125;
    if (this.mCardCount != mCount) &#123;
        ItemUseStat.getInstance().handleClick(this.mContext, 2, &quot;card_count&quot;, mCount);
        this.mCardCount = mCount;
    &#125;
    if (!this.cards[0].isInserted() &amp;&amp; !this.cards[1].isInserted() &amp;&amp; isSetDefault4GSlotIdEnabled()) &#123;
        this.cards[0].setInserted(true);
        this.cards[1].setInserted(true);
    &#125;
&#125;

public Card[] getCards() &#123;
    resumeCardsActivatedState();
    return this.cards;
&#125;

public void resumeCardsActivatedState() &#123;
    for (int i = 0; i &lt; 2; i++) &#123;
        if (!this.cards[i].isActivateChanging()) &#123;
            this.cards[i].setActivated(isCardActivate(i));
        &#125;
    &#125;
&#125;

public void onCardsActivateStarted(int slotId, boolean activated) &#123;
    this.cards[slotId].setActivateChanging(true);
&#125;

public void onCardsActivateCompleted(int slotId) &#123;
    this.cards[slotId].setActivateChanging(false);
    this.cards[slotId].setActivated(isCardActivate(slotId));
&#125;

public void setDataEnabled(boolean enabled) &#123;
    try &#123;
        ((TelephonyManager) this.mContext.getSystemService(&quot;phone&quot;)).setDataEnabled(enabled);
    &#125; catch (NullPointerException e) &#123;
        MLog.e(&quot;CardManager&quot;, &quot;Phone module did not start!&quot;);
    &#125;
&#125;

public boolean getDataEnabled() &#123;
    try &#123;
        return ((TelephonyManager) this.mContext.getSystemService(&quot;phone&quot;)).getDataEnabled();
    &#125; catch (NullPointerException e) &#123;
        MLog.e(&quot;CardManager&quot;, &quot;Phone module did not start!&quot;);
        return false;
    &#125;
&#125;

public static boolean isCTCdmaCardInGsmMode() &#123;
    try &#123;
        return Boolean.parseBoolean(String.valueOf(HuaweiTelephonyManager.class.getMethod(&quot;isCTCdmaCardInGsmMode&quot;, new Class[0]).invoke(HuaweiTelephonyManager.getDefault(), new Object[0])));
    &#125; catch (NoSuchMethodException e) &#123;
        e.printStackTrace();
        MLog.e(&quot;CardManager&quot;, &quot;error! method isCTCdmaCardInGsmMode is not suppported!&quot;);
        return false;
    &#125; catch (IllegalAccessException e2) &#123;
        e2.printStackTrace();
        MLog.e(&quot;CardManager&quot;, &quot;error! method isCTCdmaCardInGsmMode is not suppported!&quot;);
        return false;
    &#125; catch (IllegalArgumentException e3) &#123;
        e3.printStackTrace();
        MLog.e(&quot;CardManager&quot;, &quot;error! method isCTCdmaCardInGsmMode is not suppported!&quot;);
        return false;
    &#125; catch (InvocationTargetException e4) &#123;
        e4.printStackTrace();
        MLog.e(&quot;CardManager&quot;, &quot;error! method isCTCdmaCardInGsmMode is not suppported!&quot;);
        return false;
    &#125;
&#125;

public static boolean isCountryAccessTest() &#123;
    return SystemProperties.getBoolean(&quot;ro.config.dsds_telecomcta&quot;, false);
&#125;

public static boolean isChangeDefaultLTE() &#123;
    return SystemProperties.getBoolean(&quot;ro.config.change_default_LTE&quot;, true);
&#125;

public static String getRadioTech(OperatorInfo operatorInfo) &#123;
    if (operatorInfo == null) &#123;
        return &quot;&quot;;
    &#125;
    try &#123;
        Object obj = OperatorInfo.class.getMethod(&quot;getRadioTech&quot;, new Class[0]).invoke(operatorInfo, new Object[0]);
        if (!&quot;&quot;.equals(String.valueOf(obj))) &#123;
            return &quot;+&quot; + String.valueOf(obj);
        &#125;
    &#125; catch (NoSuchMethodException e) &#123;
        e.printStackTrace();
    &#125; catch (IllegalAccessException e2) &#123;
        e2.printStackTrace();
    &#125; catch (IllegalArgumentException e3) &#123;
        e3.printStackTrace();
    &#125; catch (InvocationTargetException e4) &#123;
        e4.printStackTrace();
    &#125;
    MLog.w(&quot;CardManager&quot;, &quot;error! method operatorInfo.getRadioTech() is not suppported!&quot;);
    return &quot;&quot;;
&#125;

public static void launcherHome(Context context) &#123;
    Intent home = new Intent(&quot;android.intent.action.MAIN&quot;, null);
    home.addCategory(&quot;android.intent.category.HOME&quot;);
    home.addFlags(270565376);
    try &#123;
        context.startActivity(home);
    &#125; catch (Exception e) &#123;
        MLog.e(&quot;CardManager&quot;, &quot;start home error because of &quot; + e.getMessage());
    &#125;
&#125;

public static boolean phoneIsOffhook(Context context) &#123;
    if (isMultiSimEnabled()) &#123;
        for (int i = 0; i &lt; 2; i++) &#123;
            int callState = MSimTelephonyManager.from(context).getCallState(i);
            if (callState == 2 || callState == 1) &#123;
                MLog.i(&quot;CardManager&quot;, &quot;Dual card and one is in calling.&quot;);
                return true;
            &#125;
        &#125;
    &#125;
    return false;
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">这里</span><br></pre></td></tr></table></figure>
<p>  public void callCardSettings() {<br>        ArrayList<CallCardSettingsItem> callCardSettingsList &#x3D; new ArrayList(3);<br>        callCardSettingsList.add(getCallCardSettingsItem(-1));<br>        callCardSettingsList.add(getCallCardSettingsItem(0));<br>        callCardSettingsList.add(getCallCardSettingsItem(1));<br>        CallCardSettingsDialogFragment.show(getFragmentManager(), callCardSettingsList);<br>    }</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">应该对应的是默认拨号卡 不设置，卡1 ，卡2 ，之类的。</span><br><span class="line"></span><br><span class="line">切换4g卡槽的时候有一个重要提示是否同时将默认移动数据切换到卡2，搜索之后得到如下代码</span><br></pre></td></tr></table></figure>

<pre><code>private void confirmSwitchDefaultData(final int slotId) &#123;
    if (!isFinishing()) &#123;
        this.mNeedSwitchDataAfterSetDefault4G = false;
        new Builder(this).setTitle(R.string.sync_switch_default_data_title).setMessage(getString(R.string.sync_switch_default_data_content, new Object[]&#123;getCardLabel(slotId)&#125;)).setOnCancelListener(new OnCancelListener() &#123;
            public void onCancel(DialogInterface dialog) &#123;
                ItemUseStat.getInstance().handleClick(AbstractCardManagerDrawer.this.getBaseContext(), 2, &quot;cancel_switch_sync_data&quot;, slotId);
                AbstractCardManagerDrawer.this.startSetDefault4GSlotId(slotId);
                MLog.w(&quot;CardMgrAbs&quot;, &quot;oncancel start set default 4G&quot;);
            &#125;
        &#125;).setPositiveButton(R.string.doswitch, new OnClickListener() &#123;
            public void onClick(DialogInterface dialog, int which) &#123;
                ItemUseStat.getInstance().handleClick(AbstractCardManagerDrawer.this.getBaseContext(), 2, &quot;switch_sync_data&quot;, slotId);
                AbstractCardManagerDrawer.this.mNeedSwitchDataAfterSetDefault4G = true;
                AbstractCardManagerDrawer.this.startSetDefault4GSlotId(slotId);
                MLog.d(&quot;CardMgrAbs&quot;, &quot;on positive click start set default 4G&quot;);
            &#125;
        &#125;).setNegativeButton(R.string.noswitch, new OnClickListener() &#123;
            public void onClick(DialogInterface dialog, int which) &#123;
                ItemUseStat.getInstance().handleClick(AbstractCardManagerDrawer.this.getBaseContext(), 2, &quot;cancel_switch_sync_data&quot;, slotId);
                AbstractCardManagerDrawer.this.startSetDefault4GSlotId(slotId);
                MLog.d(&quot;CardMgrAbs&quot;, &quot;on nagative click start set default 4G&quot;);
            &#125;
        &#125;).create().show();
    &#125;
&#125;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">关键代码</span><br></pre></td></tr></table></figure>
<pre><code>public boolean onPreferenceChange(Preference preference, Object newValue) &#123;
    String key = preference.getKey();
    String value = String.valueOf(newValue);
    int slotId;
    if (&quot;switch_dual_card_slots&quot;.equals(key)) &#123;
        slotId = CardSelectPreference.getSlotIdValueBy(value);
        this.mActivity.trySetDefault4GSlotId(slotId);
        ItemUseStat.getInstance().handleClick(getActivity(), 3, &quot;4g_3g_solt&quot;, slotId);
    &#125; else if (&quot;default_data_network&quot;.equals(key)) &#123;
        slotId = CardSelectPreference.getSlotIdValueBy(value);
        startChangeDefaultDataCard(slotId);
        ItemUseStat.getInstance().handleClick(getActivity(), 3, &quot;default_data_network&quot;, slotId);
    &#125; else if (&quot;switch_lte&quot;.equals(key)) &#123;
        this.mActivity.getCardManager().setDataEnabled(Boolean.parseBoolean(value));
    &#125; else if (&quot;manual_select_network_card2&quot;.equals(key)) &#123;
        boolean z;
        boolean on = Boolean.parseBoolean(value);
        this.mActivity.handleCard2Manual(on);
        if (on) &#123;
            z = false;
        &#125; else &#123;
            z = true;
        &#125;
        preference.setEnabled(z);
        ItemUseStat.getInstance().handleClick(getActivity(), 3, &quot;manual_select_network_card2&quot;);
    &#125;
    return true;
&#125;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">所处class</span><br></pre></td></tr></table></figure>
<p>SimSettingsInfoFragment</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">最后结论</span><br></pre></td></tr></table></figure>

<pre><code>public static void setPrefCardForMobileData(int slotId) &#123;
    try &#123;
        MLog.i(&quot;CardManager&quot;, &quot;card setPrefCardForMobileData:&quot; + slotId);
        HwSubscriptionManager.getInstance().setUserPrefDataSlotId(slotId);
    &#125; catch (Exception e) &#123;
        MLog.w(&quot;CardManager&quot;, &quot;set default card for mobile data failed!&quot;);
        e.printStackTrace();
    &#125;
&#125;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void startChangeDefaultDataCard(int slotId) &#123;</span><br><span class="line">        clearShowAutoChangeDefaultData();</span><br><span class="line">        CardManager.setPrefCardForMobileData(slotId);</span><br><span class="line">        this.mAscHandler.removeMessages(12);</span><br><span class="line">        Message msgTimeout = this.mAscHandler.obtainMessage(12);</span><br><span class="line">        msgTimeout.arg1 = slotId;</span><br><span class="line">        this.mAscHandler.sendMessageDelayed(msgTimeout, 120000);</span><br><span class="line">        if (!this.mNeedSwitchDataAfterSetDefault4G) &#123;</span><br><span class="line">            showWaiting(getString(R.string.switching_default_def_data_tip), 102);</span><br><span class="line">        &#125;</span><br><span class="line">        if (this.mCust != null) &#123;</span><br><span class="line">            this.mCust.saveDefaultDataSlotId(slotId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">···</span><br><span class="line"></span><br><span class="line">总结，这个app有2个类</span><br><span class="line">其中一个类```SimSettingsInfoFragment```</span><br></pre></td></tr></table></figure>
<pre><code>protected void startChangeDefaultDataCard(int slotId) &#123;
    if (slotId != this.mCardManager.getRealCardForMobileData()) &#123;
        CardManager.setPrefCardForMobileData(slotId);
        this.mAscHandler.removeMessages(12);
        Message msgTimeout = this.mAscHandler.obtainMessage(12);
        msgTimeout.arg1 = slotId;
        this.mAscHandler.sendMessageDelayed(msgTimeout, 120000);
        showWaiting(getString(R.string.switching_default_def_data_tip), 102);
    &#125;
&#125;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">以及</span><br></pre></td></tr></table></figure>
<p>AbstractCardManagerDrawer</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">的</span><br></pre></td></tr></table></figure>
<pre><code>&#125;

public void startChangeDefaultDataCard(int slotId) &#123;
    clearShowAutoChangeDefaultData();
    CardManager.setPrefCardForMobileData(slotId);
    this.mAscHandler.removeMessages(12);
    Message msgTimeout = this.mAscHandler.obtainMessage(12);
    msgTimeout.arg1 = slotId;
    this.mAscHandler.sendMessageDelayed(msgTimeout, 120000);
    if (!this.mNeedSwitchDataAfterSetDefault4G) &#123;
        showWaiting(getString(R.string.switching_default_def_data_tip), 102);
    &#125;
    if (this.mCust != null) &#123;
        this.mCust.saveDefaultDataSlotId(slotId);
    &#125;
&#125;
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">都大同小异的感觉，重要的代码还是拿到``` CardManager.setPrefCardForMobileData(slotId);</span><br></pre></td></tr></table></figure>
<p>而这个类，我这边估计需要反射才能实现。 HwCustAbstractCardManager.saveDefaultDataSlotId则是一个空的方法，没有写任何逻辑。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2815884-17aab4643ed9ee2d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/2815884-a15348d62d8d0a79.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public static int getSlotId(long subId) &#123;</span><br><span class="line">    int slotId = SubscriptionManager.getSlotId((int) subId);</span><br><span class="line">    if (Constants.isValidSlotId(slotId)) &#123;</span><br><span class="line">        return slotId;</span><br><span class="line">    &#125;</span><br><span class="line">    MLog.e(&quot;CardManager&quot;, &quot;getSlotId is invalid, we use the defualt slotid.slotId=&quot; + slotId);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>从这里分析出来一个官方类<br><code>SubscriptionManager</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @return true if a valid subId else false</span><br><span class="line"> * @hide</span><br><span class="line"> */</span><br><span class="line">public static boolean isValidSubscriptionId(int subId) &#123;</span><br><span class="line">    return subId &gt; INVALID_SUBSCRIPTION_ID ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @return true if subId is an usable subId value else false. A</span><br><span class="line"> * usable subId means its neither a INVALID_SUBSCRIPTION_ID nor a DEFAULT_SUB_ID.</span><br><span class="line"> * @hide</span><br><span class="line"> */</span><br><span class="line">public static boolean isUsableSubIdValue(int subId) &#123;</span><br><span class="line">    return subId &gt;= MIN_SUBSCRIPTION_ID_VALUE &amp;&amp; subId &lt;= MAX_SUBSCRIPTION_ID_VALUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** @hide */</span><br><span class="line">public static boolean isValidSlotIndex(int slotIndex) &#123;</span><br><span class="line">    return slotIndex &gt;= 0 &amp;&amp; slotIndex &lt; TelephonyManager.getDefault().getSimCount();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** @hide */</span><br><span class="line">public static boolean isValidPhoneId(int phoneId) &#123;</span><br><span class="line">    return phoneId &gt;= 0 &amp;&amp; phoneId &lt; TelephonyManager.getDefault().getPhoneCount();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/** @hide */</span><br><span class="line">public static void putPhoneIdAndSubIdExtra(Intent intent, int phoneId) &#123;</span><br><span class="line">    int[] subIds = SubscriptionManager.getSubId(phoneId);</span><br><span class="line">    if (subIds != null &amp;&amp; subIds.length &gt; 0) &#123;</span><br><span class="line">        putPhoneIdAndSubIdExtra(intent, phoneId, subIds[0]);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        logd(&quot;putPhoneIdAndSubIdExtra: no valid subs&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SimDialogActivity.java</span><br></pre></td></tr></table></figure>

<p>官方源码中,24是我的荣耀手机 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public static int getSlotId(int subId) &#123;</span><br></pre></td></tr></table></figure>
<p>&#x2F;&#x2F;<a target="_blank" rel="noopener" href="https://blog.csdn.net/firedancer0089/article/details/59518976">https://blog.csdn.net/firedancer0089/article/details/59518976</a><br>这个subid怎么得到呢?</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">subId</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  public int getSimState(int slotIdx) </span><br><span class="line">public String getSimOperator(int subId) </span><br></pre></td></tr></table></figure>
<p>都是int类型，但是一定要瞪大眼睛看清楚是subid还是slotid，按照一般情况双卡机器一般也就插两张卡，那么subid可以是1和2，slotid是0和1，拿一张卡做开发的同学可能掉到坑里，因为1对subid还是slotid都是合法的值</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/caidi/p/4581816.html">https://www.cnblogs.com/caidi/p/4581816.html</a></p>
<p>androidL中使用一张数据表来保存sim卡信息：telephony.db中有一张记录SIM卡信息的表，siminfo：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE siminfo(_id INTEGER PRIMARY KEY AUTOINCREMENT,</span><br><span class="line">icc_id TEXT NOT NULL,sim_id INTEGER DEFAULT -1,display_name TEXT,carrier_name TEXT,name_source </span><br><span class="line">INTEGER DEFAULT 0,color INTEGER DEFAULT 0,number TEXT,display_number_format </span><br><span class="line"></span><br><span class="line">INTEGER NOT NULL DEFAULT 1,data_roaming INTEGER DEFAULT 0,mcc INTEGER DEFAULT 0,mnc INTEGER DEFAULT 0);</span><br></pre></td></tr></table></figure>
<p>一行记录实例如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO &quot;siminfo&quot; VALUES(1,&#x27;89860114831010865147&#x27;,0,&#x27;中国联通&#x27;,&#x27;中国联通3G&#x27;,0,-16746133,&#x27;+8618516657794&#x27;,1,0,460,1);</span><br></pre></td></tr></table></figure>
<p>其中，主键_id就类似SIM卡的id，其值是从1开始递增的，sim_id类似于slot id，在双卡版本中一般只有-1&#x2F;0&#x2F;1三个值；其余的属性都好理解。</p>
<p>那如何去对应_id和sim_id呢？如函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SubscriptionController.getPhoneId(subId): // 根据subId取得phoneId</span><br><span class="line">foreach  entry: mSlotIdxToSubId.entrySet() // 具体代码，遍历mSlotIdxToSubId</span><br><span class="line">    int sim = entry.getKey(); // 对应siminfo表中的sim_id字段</span><br><span class="line">    int sub = entry.getValue(); // 对应siminfo表中的_id字段</span><br><span class="line">    if (subId == sub) &#123; return sim; &#125; // 正常流程下，这里返回的值会作为phoneId；</span><br></pre></td></tr></table></figure>
<p>就是说传入的参数subId值等于siminfo表中的某行SIM的_id值，返回其sim_id字段，这个字段代表了phone id。</p>
<p>可以参考mSlotIdxToSubId 中的元素是这样填充的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mSlotIdxToSubId.put(slotId, subId); // slotId：the slot which the SIM is inserted; </span><br></pre></td></tr></table></figure>
<p>subId：siminfo表中_id字段，一个例子：</p>
<pre><code>           _id = 3
           icc_id = 89860114831010865147
           sim_id = 1
</code></pre>
</div></article></div><div class="right-container"><div class="widget"><div class="category"><h4>分类归档</h4><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android-bug%E5%BC%82%E5%B8%B8%E4%B8%8E%E8%A7%A3%E5%86%B3/">Android-bug异常与解决</a><span class="category-list-count">46</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Blog/">Blog</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Photo/">Photo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/QQ%E6%8A%80%E5%B7%A7/">QQ技巧</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/andorid%E8%A7%A6%E6%91%B8%E4%B8%8E%E6%BB%91%E5%8A%A8/">andorid触摸与滑动</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a><span class="category-list-count">149</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android-System/">android-System</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/androidUi%E5%B7%A9%E5%9B%BA%E7%AC%94%E8%AE%B0/">androidUi巩固笔记</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/androidtv%E5%BC%80%E5%8F%91/">androidtv开发</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android%E5%8A%A8%E7%94%BB/">android动画</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android%E6%8F%92%E4%BB%B6%E5%8C%96/">android插件化</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">android源码分析</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/android%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%8E%E5%9B%BE%E5%BD%A2%E7%BB%98%E5%88%B6/">android自定义与图形绘制</a><span class="category-list-count">19</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c/">c#</a><span class="category-list-count">61</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c-c-JNI-Ndk/">c-c---JNI-Ndk</a><span class="category-list-count">76</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/eclipse/">eclipse</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/gradle/">gradle</a><span class="category-list-count">24</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ide%E6%8A%80%E5%B7%A7/">ide技巧</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kotlin-with-java/">kotlin-with-java</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mac-ios/">mac-ios</a><span class="category-list-count">28</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">19</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell-bat-lua%E8%84%9A%E6%9C%AC/">shell-bat-lua脚本</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/window/">window</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%8A%E8%BD%A6/">上车</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%AC%E5%91%8A/">公告</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8A%9E%E5%85%AC/">办公</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9C%B0%E7%90%83/">地球</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9C%B0%E7%90%83/%E4%B8%AD%E5%9B%BD/">中国</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9C%B0%E7%90%83/%E4%B8%AD%E5%9B%BD/%E6%B9%96%E5%8D%97/">湖南</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9C%B0%E7%90%83/%E4%B8%AD%E5%9B%BD/%E6%B9%96%E5%8D%97/%E5%A8%84%E5%BA%95/">娄底</a><span class="category-list-count">1</span></li></ul></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%9E%83%E5%9C%BE%E5%A0%86/">垃圾堆</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7/">奇淫技巧</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%8A%80%E5%B7%A7/">小程序技巧</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BB%BA%E6%A8%A1/">建模</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%83%85%E8%BF%81QQ%E6%9C%BA%E5%99%A8%E4%BA%BA/">情迁QQ机器人</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%83%85%E8%BF%81%E8%BD%AF%E4%BB%B6/">情迁软件</a><span class="category-list-count">39</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%89%93%E8%B5%8F/">打赏</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E5%AD%A6/">数学</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%A5%E8%AE%B0%E6%9C%AC/">日记本</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B1%87%E7%BC%96/">汇编</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%8B%E8%AF%95/">测试</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%8B%E8%AF%95%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/">测试与自动化</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">游戏开发</a><span class="category-list-count">68</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/">版本控制</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB/">生活</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A1%AC%E4%BB%B6%E7%BB%B4%E4%BF%AE/">硬件维修</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A7%91%E5%B9%BB/">科幻</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E6%95%B0%E5%AD%A6%E9%97%AE%E9%A2%98/">程序员的数学问题</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BC%96%E7%A8%8B%E6%9D%82%E9%A1%B9/">编程杂项</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%AB%99%E5%BB%BA%E8%AE%BE/">网站建设</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BE%8E%E5%A5%B3/">美女</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BF%BB%E8%AF%91%E8%A7%86%E9%A2%91%E6%95%99%E7%A8%8B/">翻译视频教程</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%B0%E5%BF%86/">记忆</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B7%A8%E5%B9%B3%E5%8F%B0app/">跨平台app</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B7%AF%E7%94%B1%E5%99%A8/">路由器</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%80%86%E5%90%91/">逆向</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%80%86%E5%90%91%E4%B8%8E%E5%AE%89%E5%85%A8/">逆向与安全</a><span class="category-list-count">87</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9A%8F%E7%AC%94/">随笔</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%A2%E8%AF%95%E6%94%BB%E5%85%8B/">面试攻克</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86/">音视频处理</a><span class="category-list-count">6</span></li></ul></div></div><div class="widget"><div class="tagcloud"><h4>标签云</h4><a href="/tags/Android-bug%E5%BC%82%E5%B8%B8%E4%B8%8E%E8%A7%A3%E5%86%B3/" style="font-size: 18.06px;">Android-bug异常与解决</a> <a href="/tags/CDN/" style="font-size: 10px;">CDN</a> <a href="/tags/Git/" style="font-size: 10.32px;">Git</a> <a href="/tags/JAVA/" style="font-size: 10px;">JAVA</a> <a href="/tags/Lua/" style="font-size: 10px;">Lua</a> <a href="/tags/QQ%E6%8A%80%E5%B7%A7/" style="font-size: 10px;">QQ技巧</a> <a href="/tags/WEB/" style="font-size: 10.32px;">WEB</a> <a href="/tags/andorid%E8%A7%A6%E6%91%B8%E4%B8%8E%E6%BB%91%E5%8A%A8/" style="font-size: 12.9px;">andorid触摸与滑动</a> <a href="/tags/android/" style="font-size: 19.68px;">android</a> <a href="/tags/android-studio/" style="font-size: 10px;">android studio</a> <a href="/tags/android-System/" style="font-size: 15.48px;">android-System</a> <a href="/tags/androidUi%E5%B7%A9%E5%9B%BA%E7%AC%94%E8%AE%B0/" style="font-size: 11.29px;">androidUi巩固笔记</a> <a href="/tags/androidtv%E5%BC%80%E5%8F%91/" style="font-size: 10.32px;">androidtv开发</a> <a href="/tags/android%E5%8A%A8%E7%94%BB/" style="font-size: 10.32px;">android动画</a> <a href="/tags/android%E6%8F%92%E4%BB%B6%E5%8C%96/" style="font-size: 14.19px;">android插件化</a> <a href="/tags/android%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" style="font-size: 11.94px;">android源码分析</a> <a href="/tags/android%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%8E%E5%9B%BE%E5%BD%A2%E7%BB%98%E5%88%B6/" style="font-size: 15.81px;">android自定义与图形绘制</a> <a href="/tags/c/" style="font-size: 18.39px;">c#</a> <a href="/tags/c-c-JNI-Ndk/" style="font-size: 19.03px;">c-c---JNI-Ndk</a> <a href="/tags/consectetur/" style="font-size: 10px;">consectetur</a> <a href="/tags/eclipse/" style="font-size: 11.29px;">eclipse</a> <a href="/tags/git/" style="font-size: 11.94px;">git</a> <a href="/tags/gradle/" style="font-size: 16.77px;">gradle</a> <a href="/tags/ide%E6%8A%80%E5%B7%A7/" style="font-size: 16.13px;">ide技巧</a> <a href="/tags/java/" style="font-size: 14.84px;">java</a> <a href="/tags/kotlin-with-java/" style="font-size: 15.16px;">kotlin-with-java</a> <a href="/tags/linux/" style="font-size: 11.61px;">linux</a> <a href="/tags/mac-ios/" style="font-size: 17.42px;">mac-ios</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/php/" style="font-size: 12.9px;">php</a> <a href="/tags/python/" style="font-size: 15.81px;">python</a> <a href="/tags/shell-bat-lua%E8%84%9A%E6%9C%AC/" style="font-size: 12.58px;">shell-bat-lua脚本</a> <a href="/tags/window/" style="font-size: 14.84px;">window</a> <a href="/tags/xposed%E6%8F%92%E4%BB%B6/" style="font-size: 10px;">xposed插件</a> <a href="/tags/%E4%B8%83%E7%89%9B/" style="font-size: 10px;">七牛</a> <a href="/tags/%E4%B8%8A%E8%BD%A6/" style="font-size: 11.61px;">上车</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E7%BC%96%E5%86%99/" style="font-size: 10px;">代码编写</a> <a href="/tags/%E5%85%8DRoot/" style="font-size: 10px;">免Root</a> <a href="/tags/%E5%85%AC%E5%91%8A/" style="font-size: 10.32px;">公告</a> <a href="/tags/%E5%88%86%E8%BA%AB%E5%A4%A7%E5%B8%88/" style="font-size: 10px;">分身大师</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 12.9px;">前端</a> <a href="/tags/%E5%8A%9E%E5%85%AC/" style="font-size: 10px;">办公</a> <a href="/tags/%E5%90%8E%E7%AB%AF/" style="font-size: 10px;">后端</a> <a href="/tags/%E5%9B%BE%E7%89%87/" style="font-size: 10px;">图片</a> <a href="/tags/%E5%9E%83%E5%9C%BE%E5%A0%86/" style="font-size: 13.87px;">垃圾堆</a> <a href="/tags/%E5%A5%87%E6%B7%AB%E6%8A%80%E5%B7%A7/" style="font-size: 13.23px;">奇淫技巧</a> <a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%8A%80%E5%B7%A7/" style="font-size: 14.19px;">小程序技巧</a> <a href="/tags/%E5%BB%BA%E6%A8%A1/" style="font-size: 17.1px;">建模</a> <a href="/tags/%E6%83%85%E8%BF%81QQ%E6%9C%BA%E5%99%A8%E4%BA%BA/" style="font-size: 10px;">情迁QQ机器人</a> <a href="/tags/%E6%83%85%E8%BF%81%E8%BD%AF%E4%BB%B6/" style="font-size: 17.74px;">情迁软件</a> <a href="/tags/%E6%89%93%E8%B5%8F/" style="font-size: 10px;">打赏</a> <a href="/tags/%E6%8F%92%E4%BB%B6/" style="font-size: 10px;">插件</a> <a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 11.61px;">数学</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 11.94px;">数据库</a> <a href="/tags/%E6%97%A5%E8%AE%B0%E6%9C%AC/" style="font-size: 10.65px;">日记本</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E4%BA%BA/" style="font-size: 10px;">机器人</a> <a href="/tags/%E6%B1%87%E7%BC%96/" style="font-size: 10px;">汇编</a> <a href="/tags/%E6%B5%8B%E8%AF%95%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96/" style="font-size: 10.32px;">测试与自动化</a> <a href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/" style="font-size: 18.71px;">游戏开发</a> <a href="/tags/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" style="font-size: 10.32px;">版本控制</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 14.52px;">生活</a> <a href="/tags/%E7%A1%AC%E4%BB%B6%E7%BB%B4%E4%BF%AE/" style="font-size: 10px;">硬件维修</a> <a href="/tags/%E7%A7%91%E5%B9%BB/" style="font-size: 10px;">科幻</a> <a href="/tags/%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E6%95%B0%E5%AD%A6%E9%97%AE%E9%A2%98/" style="font-size: 13.55px;">程序员的数学问题</a> <a href="/tags/%E7%BC%96%E7%A8%8B%E6%9D%82%E9%A1%B9/" style="font-size: 16.45px;">编程杂项</a> <a href="/tags/%E7%BF%BB%E8%AF%91%E8%A7%86%E9%A2%91%E6%95%99%E7%A8%8B/" style="font-size: 10px;">翻译视频教程</a> <a href="/tags/%E8%97%8F%E5%93%81/" style="font-size: 20px;">藏品</a> <a href="/tags/%E8%A7%86%E9%A2%91/" style="font-size: 10px;">视频</a> <a href="/tags/%E8%AE%B0%E5%BF%86/" style="font-size: 10.97px;">记忆</a> <a href="/tags/%E8%B7%A8%E5%B9%B3%E5%8F%B0app/" style="font-size: 12.9px;">跨平台app</a> <a href="/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/" style="font-size: 12.26px;">路由器</a> <a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 10px;">逆向</a> <a href="/tags/%E9%80%86%E5%90%91%E4%B8%8E%E5%AE%89%E5%85%A8/" style="font-size: 19.35px;">逆向与安全</a> <a href="/tags/%E9%93%BE%E6%8E%A5/" style="font-size: 10.32px;">链接</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 11.29px;">随笔</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E6%94%BB%E5%85%8B/" style="font-size: 10px;">面试攻克</a> <a href="/tags/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86/" style="font-size: 11.61px;">音视频处理</a></div></div><div class="widget"><div class="recent"><h4>最近文章</h4><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2023/08/06/soft_use_status/">soft_use_status</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/08/06/hello-world%E4%B8%8Ehexo%E7%9A%84%E5%BC%80%E5%A7%8B/">Hello World</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/03/13/android-rxjava%E6%96%87%E6%9C%AC%E6%94%B9%E5%8F%98-%E5%88%87%E6%8D%A2%E5%90%8E%E5%8F%B0%E6%89%A7%E8%A1%8C-%E8%80%97%E6%97%B6%E5%A4%84%E7%90%86%E5%AE%8C%E6%AF%95%E5%86%8D%E8%BF%94%E5%9B%9E/">androidrxjava文本改变切换后台执行耗时处理完毕再返回</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/03/11/java%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9A%E4%B9%89%E8%84%9A%E6%9C%AC%E8%A7%84%E5%88%99,%E8%A7%A3%E6%9E%90%E7%AE%80%E5%8D%95%E7%9A%84%E8%84%9A%E6%9C%AC%E5%AE%9E%E7%8E%B0%E6%89%93%E5%8D%B0%E5%9B%BE%E5%BD%A2%E5%B8%83%E5%B1%80%E5%AE%9A%E5%88%B6-%E5%92%A8%E8%AF%A2%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E6%89%BE%E5%AE%9E%E7%8E%B0%E7%81%B5%E6%84%9F1%E5%B0%8F%E6%97%B6%E5%AE%9E%E7%8E%B0/">java自定义定义脚本规则解析简单的脚本实现打印图形布局定制咨询人工智能找实现灵感1小时实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/03/11/%E6%95%B0%E5%AD%A6%E5%88%86%E9%85%8D%E7%9A%84%E7%AE%80%E5%8D%95%E5%A5%97%E8%B7%AF%E4%BB%A3%E7%A0%81/">数学分配的简单套路代码</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/03/03/%5B%E5%8E%9F%E5%88%9B%5Dandroid%E7%A6%81%E6%AD%A2%E7%BC%96%E8%BE%91%E6%A1%86%E7%BC%96%E8%BE%91%E4%BD%86%E6%98%AF%E5%85%81%E8%AE%B8%E9%80%89%E6%8B%A9%E6%9F%A5%E7%9C%8B%E5%86%85%E5%AE%B9%E8%B6%85%E5%87%BA%E7%9A%84%E9%83%A8%E5%88%86%E7%9A%84%E6%96%B9%E6%B3%95/">原创android禁止编辑框编辑但是允许选择查看内容超出的部分的方法</a></li></ul></div></div><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/2018/07/15/%E8%A7%A3%E5%86%B3%E8%8D%A3%E8%80%808-%E6%89%8B%E6%9C%BA%E6%95%B0%E6%8D%AE%E8%BF%9E%E6%8E%A5%E5%8D%A1%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E5%90%8E%E8%87%AA%E5%8A%A8%E8%BF%98%E5%8E%9F%E9%97%AE%E9%A2%98%E3%80%82/" class="prev">PREV</a><a href="/2018/07/14/%E9%80%9A%E8%BF%87shell-%E7%A7%BB%E5%8A%A8%E7%A7%BB%E5%8A%A8app%E7%B3%BB%E7%BB%9F%E7%9B%AE%E5%BD%95%E8%AE%A9app%E6%94%AF%E6%8C%81%E7%B3%BB%E7%BB%9F%E6%9D%83%E9%99%90/" class="next">NEXT</a></div><!--PC和WAP自适应版--><div id="SOHUCS" sid="2018/07/14/荣耀8-4g选择了3g卡-导致默认数据重启后自动跟随bug研究分析以及编写xposed修复bug/"> </div><script>(function() {
    var appid = 'cytVgXm93'; 
    var conf = 'e46b9c0a4ede5c70e062020c1d3651e1';
    var width = window.innerWidth || document.documentElement.clientWidth; 
    if (width < 960) { 
    window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })();</script><div class="copyright"><p>© 2015 - 2023 <a target="_blank">情随事迁</a>, 微博 <a href="https://weibo.com/qssq666" target="_blank">qssq666</a> <br>  <a href="https://space.bilibili.com/101043764?spm_id_from=333.1007.0.0" target="_blank">bilibli</a>  <a href="https://www.jianshu.com/u/9b0768e66d01" target="_blank">简书</a></p><p>总计访问量 <i data-hk-site="-"></i></p></div><div class="totop"><i></i></div></div></footer>
<script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="http://apps.bdimg.com/libs/jquery/1.8.2/jquery.min.js"></script><script src="/scripts/av-min-1.5.0.js"></script><script src="/scripts/hit-kounter-lc-0.3.0.js"></script><script src="/scripts/arAnchor.js"></script><script src="/scripts/main.js"></script></body></html>